---
title: "complications_list"
output: html_document
---

```{r}
v<-readRDS("C:/Users/teg83/Documents/hcup_data/hcup_obj/SID_obj/az_sidc_2008.RDS")
x<-readRDS("C:/Users/teg83/Documents/hcup_data/hcup_diab/SID_diab_obj/nc_sidc_2017_diab.RDS")
x<-readRDS("C:/Users/teg83/Documents/hcup_data/hcup_diab/SID_diab_obj/nc_sidc_2014_diab.RDS")
x<-readRDS("C:/Users/teg83/Documents/hcup_data/hcup_diab/NIS_diab_obj/nis_2008_diab.RDS")


database_size<-as.numeric(round(object.size(x), digits=-5))
#database_id<-ifelse(database_size>=723500000, "nat", "state")

#if(database_id=="nat"){
#yr=mean(x$variables$YEAR)
#ifelse(yr %in% c(2016, 2017), x<-icd_10_nat(x), 
       #x<-icd_9_nat(x))
#} else {
#yr=mean(x$YEAR)
#ifelse(yr %in% c(2016, 2017), x<-icd_10_state(x), 
       #x<-icd_9_state(x))
#}

yr=mean(x$YEAR)
ifelse(yr %in% c(2016, 2017), x<-icd_10_var(x), x<-icd_9_var(x))
#ifelse(yr %in% c(2016, 2017), chck10<-icd_10_var(x), chck9<-icd_9_var(x))

chck9<-count(x$dxreason)
count(x$spec1)
count(x$spec)
chck9_spec<-count(x$spec)
chck9_com<-count(x$dm_com_all)
chck9_inj<-count(x$inj_any)
chck9_spec
chck9_com
chck9_inj


chck10<-count(x$dxreason)
chck10
chck10_spec<-count(x$spec)
chck10_com<-count(x$dm_com_all)
chck10_inj<-count(x$inj_any)
x$dm_com_noinj<-ifelse(x$dm_com_all==1 & x$inj_any==0,1,0)
count(x$dm_com_noinj)
chck10_spec
chck10_com
chck10_inj
count(x$spec1)

21583
90000
nrow=254007
```

```{r}
icd_9_var<-function(x){
ICD<-startsWith(colnames(x), "DX")
ICD<-colnames(x[ICD])
ICD<-ICD[!grepl('CCS', ICD)]
PRC<-startsWith(colnames(x), "PR")
#rm(list = ls(all.names = TRUE))
#ICD9, Diabetes Complications
#short term complications
keto<-c(25010, 25011, 25012, 25013)
dm_coma_hyperosmo<-c(25020, 25021,25022,25023,25030,25031,25032,25033)
dm_shorterm_ICD9<-c(keto,dm_coma_hyperosmo)
rm(keto,dm_coma_hyperosmo)
#long term complications
dm_renal<-c(2504, 25040, 25041, 25042, 25043)
dm_opth<-c(2505, 25050, 25051, 25052, 25053)
dm_neuro<-c(2506, 25060, 25061, 25062, 25063)
dm_circ<-c(2507, 25070, 25071, 25072, 25073, 2507, 25070, 25071, 25072, 25073)
dm_other<-c(2508, 25080, 25081, 25082, 25083, 2509, 25090, 25091, 225092, 25093)
dm_longterm_ICD9<-c(dm_renal, dm_opth, dm_neuro, dm_circ, dm_other)
rm(dm_renal, dm_opth, dm_neuro, dm_circ, dm_unsp,dm_other)
uncontrolled_dm<-c(25002, 25003)
#leau include procedure codes
leau_proc<-c(8410, 8412, 8414, 8415, 8416, 8417, 8418,8419)
#back to conditions
lower_ulc_infl_inf<-c(4540, 7071, 6806, 6807, 6811, 6826, 6827, 71105, 71106, 71107, 73005,73006, 73007, 73015, 73016, 73017, 73025, 73026, 73027, 73035, 73036, 73037, 73085, 73086, 73087, 73095, 73096, 73097, 7854)
#hypogl<-c(2510,2511,2512,2703, 7750, 7756, 9623, 25880, 2598, 2727, 68100, 7071,7072, 7073,7074,7075, 7076, 7077, 7078, 7079, 73000, 7301, 7302, 7318, 2503)
#for ginde et al
hypo_rule1<-c("2510", "2511", "2512", "2703", "7750", "7756")
hypo_rule2<-c("2508")
hypo_rule3<-c("2598", "2727", "6869", as.character(paste0("707", 1:9)), "7093", "7300", "7301", "7302", "7318")
hypo_rule3_3char<-c("681", "682")
#not used here
hypo_rule_exc<-"2503"
hypo_rule<-function(x){
hypo_1<-ifelse(substring(x, 1,4) %in% hypo_rule1, 1, 0)
hypo_2<- ifelse(substring(x, 1,4) %in% hypo_rule2, 1, 0)
hypo_3<-ifelse(substring(x, 1,4) %in% hypo_rule3, 1, 0)
hypo_4<-ifelse(substring(x, 1,3) %in% hypo_rule3_3char, 1, 0)
hypo_exc1<-ifelse(substring(x,1,4) %in% hypo_rule_exc, 1,0)
hypo_5<-ifelse(hypo_3==1 |hypo_4 ==1, 1,0)
hypo_6<-ifelse(hypo_2==1 & hypo_5==0, 1,0)
hypo_exc2<-ifelse(hypo_5==1 & hypo_exc1==1, 1,0)
hypo_7<-ifelse(hypo_1==1|hypo_6==1, 1, 0)
hypo<-ifelse(hypo_7==1 & hypo_exc2==0, 1, 0)
return(hypo)
}
x$hypo<-as.numeric(Reduce('|', lapply(x[ICD], hypo_rule)))

diab_COMP_ICD9<-c(lower_ulc_infl_inf)
rm(lower_ulc_infl_inf, hypo_rule1, hypo_rule2, hypo_rule3, hypo_rule3_3char)

#ICD9, Diabetes Comorbidities
#from https://care.diabetesjournals.org/content/diacare/suppl/2018/03/20/dci18-0007.DC1/DCi180007SupplementaryData.pdf
neuro<-c(3581, 3568, 354, 355, 7135, 3371, 3572, 7292, 2506, 434, 430, 431, 432, 438, 433, 437, 436, 435)
pvd<-c(440, 444, 4471, 443, 451, 452, 453, 454, 7854,885, 886,887,895,897, 707)
cvd<-c(441, 442, 458, 413, 426, 427, 4292, 4293,425, 411, 428, 4291, 410,412,414,401,402,403,404,405)
renal<-c(590, 596, 595, 587, 580, 581, 582, 583, 7910, 584, 586, 588, 593, 5990, 585)
metabol<-c(2710, 2711, 2720, 2723, 2767, 2721, 2733, 261, 2727, 2598, 2724, 2714)
opthal<-c(362, 3640, 3644, 377, 2505, 366, 365, 368, 369)
other<-c(0792, 1123, 73017, 5589, 60784, 3801, 7093, 1121, 681, 682, 7318, 2510, 5363)


acute_coronory<-c(4110,4111, 4118, 41181,41189)
acute_myocardial<-c(410, 41001, 41002,4101, 41011,41012,4102,41021,41022, 4103, 41031, 41032, 4104, 41041,
41042, 4105, 41051, 41052, 4106, 41061, 41062, 4107, 41071, 41072, 4108,41081, 41082, 4109, 41091, 41092, 41189)
angina<-c(4111, 4131, 4139, 7865, 78651, 78652, 78659)
arrythmia<-c(42741, 42742, 42760, 42761, 42769, 42781, 42789, 4279, 7850, 7851, 7853)
CABG_carot_claudic_revasc<-c(4331, 43311, 4333, 43331, 4359, 36234, 3812, 
427, 42731, 42732, 42741, 42742, 42781, 42789, 42820, 42821, 42822, 42823, 42830, 42831, 42832, 42833, 42840, 42841, 42842, 42843, 43300, 43301, 43310, 43311, 43320, 43321, 43330, 43331, 43380, 43381, 43390, 43391, 43400, 43401, 43410, 43411, 43490, 43491, 43810, 43811, 43812, 43813, 43814, 43814, 43819, 43819, 43820, 43821, 43822, 43830, 43831, 43832, 43840, 43841, 43842, 43850, 43851, 43852, 43853, 43881, 43882, 43883, 43884, 43885, 43889, 99700, 99701, 99702, 99709, 4439)
stroke_ICD9<-c(34200, 34201, 34202, 34203, 34210, 34211, 34212, 34280, 34281, 34282, 34290, 34291, 34292, 36234, 36812, 42731, 42732, 42741, 42742, 42781, 42789, 42820, 42821, 42822, 42823, 42830, 42831, 42832, 42833, 42840, 42841, 42843, 42843, 43300, as.numeric(paste0(433, 00:99)), as.numeric(paste0(434, 00:99)), as.numeric(paste0(438, 10:89)), as.numeric(paste0(518, 51:53)), 78191, 78192, 78193, 78194, 78199, 99700, 99701, 99702, 99709, 99731, 99732, 99739, 99741, 99749, 99771, 99772, 99779, 99851, 99859)
heart_fail<-c(4280, 4281, 42820, 42821, 42822, 42823, 42830, 42831, 42832, 42833, 42840, 42841, 42842, 42843, 4289)
pad_pvd<-c(44021, 4423, 44381, 4439, 8921, 0400, 44422, 70710, 70711, 70712, 70713, 70714, 70715, 70719, 7854)
stroke_pn<-c(430, 431, 4320, 4321, 4329, 43301, 43311, 43321, 43331, 43381, 43391, 43401, 43411, 43491, 43391, 43401, 43411, 43491, 436, "V1254")
obesity<-c(2780, 27800, 27801, 27802, 27803, 79391, "V8521", "V8522", "V8523", "V8524", "V8525", "V8530", "V8531", "V8532", "V8533", "V8534", "V8535", "V8536", "V8537", "V8538", "V854", "V8541", "V8542", "V8543", "V8544", "V8545", "V8554")
gout<-c(2740, 27400, 27401, 27402, 27403, 27410, 27411, 27419, 27481, 27482, 27489, 2749)
hypertension<-c(4011, 4019, 40200, 40201, 40210, 40211, 40290, 40291, 4030, 40300, 40301, 4031, 40310, 40311, 4039, 40390, 40391, 4040, 40400, 40401, 40402, 40403, 4041, 40410, 40411, 40412, 40413, 4049, 40490, 40491, 40492, 40493, 4010, 40501, 40509, 40511, 40519, 40591, 40599, 4372)
pneumonia<-c(00322, 0203, 0204, 0205, 0212, 0221, 0310, 0391, 481, 4820, 4821, 4822, 4823, 48230, 48231, 48232, 48239, 4824, 48240, 48241, 48242, 48249, 4828, 48281, 48282, 48283, 48284, 48289, 4829, 486, 0521, 0551, 0730, 0830, 1124, 1140, 1144, 1145, 11505, 11515, 11595, 1304, 1363, 4800, 4801, 4802, 4803, 4808, 4809, 483, 4830, 4831, 4838, 4841, 4843, 4845, 4846, 4847, 4848, 485, 5130, 5171)
hyperlipid<-c(2724)
osa<-c(32723, 78053, 32723)
depress<-c(26920, 29622, 29623, 29630, 29623, 29630, 29632, 29633, 30000, 30001, 30002, 30009, 30021, 30022, 30023, 30029, 3003, 3004, 3006, 3007, 30081, 30082, 30089, 3009, 3080, 3081, 3082, 3083, 3084, 3089, 3090, 3091, 30924, 30928, 30929, 3093, 3094, 30981, 30982, 30983, 30989, 3099, 311, "V6284", "E9500", "E9501", "E9502", "E9503", "E9504", "E9505", "E9506", "E9507", "E9508", "E9509", "E9510", "E9511", "E9511", "E9518", "E9520", "E9521", "E9528", "E9529","E9530", "E9531", "E9538", "E9539", "E954", "E9950", "E9551", "E9552", "E9554", "E9555", "E9556", "E9559", "E956", "E9570", "E9571", "E9572", "E9579", "E9580", "E9581", "E9582", "E9583", "E9584", "E9585", "E9587", "E9588")

#procedure codes
surgical_revasc<-c(3925, 3929, 3808, 3816, 3818, 395, 397, 399, 063, 361, 3610, 3611, 3612, 3613, 3614, 3615, 3616, 3617, 3619, 362)

#use depress_excl to remove cases of depression that aren't correct
depress_excl<-c(29600, 29603, 29604, 29610, 29613, 29614, 29624, 29634, 29640, 29641, 29642, 29643, 29644, 29650, 29652, 29653, 29654, 29660, 29662, 29663, 29664, 2967, 29680, 29690, 29699, 29500, 29501, 29502, 29503, 29504, 29505, 29510, 29511, 29512, 29513, 29515, 29520, 29521, 29522, 29523, 29524, 29530, 29531, 29532, 29533, 29534, 29535, 29540, 29541, 29542, 29543, 29544, 29545, 29550, 29553, 29554, 29560, 29560, 29562, 29563, 29564, 29565, 29570, 29571, 29572, 29573, 29574, 29575, 29580, 29582, 29583, 29584, 29585, 29590, 29591, 29592, 29593, 29595, 2970, 2971, 2972, 2973, 2978, 2980, 2981, 2982, 2983, 2984, 2988,2989)

#dm-specific
dm_specific<-as.character(c(dm_shorterm_ICD9, dm_longterm_ICD9,diab_COMP_ICD9, uncontrolled_dm))
dm_specific<-unlist(dm_specific)
rm(dm_shorterm_ICD9, dm_longterm_ICD9,diab_COMP_ICD9, uncontrolled_dm)

dm_specific_cm<-function(x){
  spec1<-ifelse(x %in% dm_specific, 1, 0)
  return(spec1)
}
x$dmspec1<-as.numeric(Reduce('|', lapply(x[ICD], dm_specific_cm)))
dm_specific_prc<-function(x){
  spec2<-ifelse(x %in% leau_proc, 1, 0)
  return(spec2)
}
x$dmspec2<-as.numeric(Reduce('|', lapply(x[PRC], dm_specific_prc)))
x$spec<-ifelse(x$dmspec1==1 | x$dmspec2==1 | x$hypo==1, 1, 0)
x$spec1<-ifelse(x$DX1 %in% dm_specific | x$DX1 %in% leau_proc, 1, 0)
drop<-colnames(x)[startsWith(colnames(x), "dmspec")]
drop<-c(drop, "hypo")
x[drop]<-NULL

#dm-comorbid
diab_COMORBID_ICD9<-c(neuro, pvd, cvd, renal, metabol, opthal, acute_coronory, acute_myocardial, angina, arrythmia, CABG_carot_claudic_revasc, surgical_revasc, heart_fail, pad_pvd, stroke_ICD9, depress, obesity, gout, hypertension, pneumonia, osa)


dm_comorbid_cm<-function(x){
  spec1<-ifelse(x %in% diab_COMORBID_ICD9, 1, 0)
  return(spec1)
}
x$com1<-as.numeric(Reduce('|', lapply(x[ICD], dm_comorbid_cm)))
dm_comorbid_prc<-function(x){
  spec2<-ifelse(x %in% surgical_revasc, 1, 0)
  return(spec2)
}
x$com2<-as.numeric(Reduce('|', lapply(x[PRC], dm_comorbid_prc)))
dm_comorbid_exc<-function(x){
  spec3<-ifelse(x %in% depress_excl, 1,0)
}
x$com3<-as.numeric(Reduce('|', lapply(x[ICD], dm_comorbid_exc)))
x$com4<-ifelse(x$com1==1 | x$com2==1, 1,0)
x$dm_com_all<-ifelse(x$com4==1 & x$com3==0, 1, 0)
x$dm_com<-ifelse(x$spec==0 & x$dm_com_all==1, 1, 0)
drop<-colnames(x)[startsWith(colnames(x), "com")]
x[drop]<-NULL

stroke_ind<-function(x){
  spec1<-ifelse(x %in% stroke_ICD9, 1, 0)
  return(spec1)
}
x$stroke<-as.numeric(Reduce('|', lapply(x[ICD], stroke_ind)))
AMI_ind<-function(x){
  spec2<-ifelse(x %in% acute_myocardial, 1, 0)
  return(spec2)
}
x$ami<-as.numeric(Reduce('|', lapply(x[ICD], AMI_ind)))
ACS_ind<-function(x){
  spec2<-ifelse(x %in% acute_coronory, 1, 0)
  return(spec2)
}
x$acs<-as.numeric(Reduce('|', lapply(x[ICD], ACS_ind)))
heart_fail_ind<-function(x){
  spec2<-ifelse(x %in% heart_fail, 1, 0)
  return(spec2)
}
x$heart_fail<-as.numeric(Reduce('|', lapply(x[ICD], heart_fail_ind)))
arrythmia_ind<-function(x){
  spec2<-ifelse(x %in% arrythmia, 1, 0)
  return(spec2)
}
x$arrythmia<-as.numeric(Reduce('|', lapply(x[ICD], arrythmia_ind)))
x$comgroup<-ifelse(x$stroke==1|x$ami==1|x$acs==1|x$heart_fail==1|x$arrythmia==1,1,0)
comgroup<-c("stroke", "ami", "acs", "heart_fail", "arrythmia")
x[comgroup]<-NULL

rm(neuro, pvd, cvd, renal, metabol, opthal, acute_coronory, acute_myocardial, angina, arrythmia, CABG_carot_claudic_revasc, surgical_revasc, heart_fail, pad_pvd, stroke_ICD9, depress, obesity, gout, hypertension, pneumonia, hyperlipid, osa, comgroup)
#non-dm
#ICD9, Not Diabetes Related maybe use major diagnostic code
#from https://www.hcup-us.ahrq.gov/db/vars/sedddistnote.jsp?var=injury, hcup ICD-9 diagnosis codes used to identify injury discharges

#injury from https://www.hcup-us.ahrq.gov/db/vars/i10_injury/nedsnote.jsp
inj_3char<-c(800:909, 910:994)
inj_4char<-c(9092, 9094, 9099, 9949, 9995)
inj_5char<-c(99951:99959, 99580:99585)
inj_exc_3char<-c(996:999)
inj_exc_4char<-c(9093, 9095, 9950:9954, 9950, 9954, 9957, 99586, 99589)

inj_ind<-function(x){
inj_1<- ifelse(substring(x, 1,3) %in% inj_3char, 1, 0)
inj_2<-ifelse(substring(x, 1,4) %in% inj_4char, 1, 0)
inj_3<-ifelse(substring(x, 1,5) %in% inj_5char, 1, 0)
inj<-ifelse(inj_1==1 | inj_2==1 | inj_3==1, 1, 0)
inj_exc1<- ifelse(inj==1 & substring(x,1,3) %in% inj_exc_3char, 1,0)
inj_exc2<- ifelse(inj==1 & substring(x,1,4) %in% inj_exc_4char, 1,0)
inj_exc<-ifelse(inj_exc1==1 |inj_exc2==1, 1, 0)
non_dm<-ifelse(inj ==1 & inj_exc ==0, 1, 0)
return(non_dm)
}
x$inj_any<-as.numeric(Reduce('|', lapply(x[ICD], inj_ind)))
x$inj<-ifelse(x$comgroup==0 & x$spec==0 & x$inj_any==1, 1,0)


#*****************IDENTIFYING INJURY TYPE********************#
#Injuries to the head; neck; thorax; abdomen, lower back, lumbar spine, pelvis and external genitals; shoulder and upper arm; elbow and forearm; wrist, hand and fingers; hip and thigh; knee and lower leg; ankle and foot.
#includes contusions, late effects of injuries, open wounds, sprains, dislocaitons and fractures
#inj_body<-c(800:829, 830:848,850:854, 860:869, 870:879, 880:887, 890:897, 900-904, 910:919, 920:924, 925:929)
#inj_burn_foreign_body<-c(930-939, 940:949)
#inj_nerve_spinal<-c(950-957)
#Poisoning by drugs, medicinal and biological substances, Toxic effects of substances chiefly nonmedicinal as to source, 
#inj_poison<-c(960-989)
#Other and unspecified effects of external causes: radiation, frostbite, heat/light, drowning, motion sickness, anaphylaxis, etc.
#inj_other<-c(990-995)
#other includes:

#inj_type1<-function(x){
#inj_1<- ifelse(substring(x, 1,3) %in% inj_body, 1, 0)
#return(inj_1)
#}
#x$inj_body<-as.numeric(Reduce('|', lapply(x[ICD], inj_type1)))

#inj_type2<-function(x){
#inj_2<- ifelse(substring(x, 1,3) %in% inj_burn_foreign_body, 1, 0)
#return(inj_2)
#}
#x$inj_body<-as.numeric(Reduce('|', lapply(x[ICD], inj_type2)))

#inj_type3<-function(x){
#inj_3<- ifelse(substring(x, 1,3) %in% inj_nerve_spinal, 1, 0)
#return(inj_3)
#}
#x$inj_body<-as.numeric(Reduce('|', lapply(x[ICD], inj_type3)))

#inj_type4<-function(x){
#inj_4<- ifelse(substring(x, 1,3) %in% inj_poison, 1, 0)
#return(inj_4)}
#x$inj_body<-as.numeric(Reduce('|', lapply(x[ICD], inj_type4)))

#inj_type5<-function(x){
#inj_5<-ifelse(substring(x, 1,3) %in% inj_other, 1, 0)
#return(inj_5)
#}
#x$inj_body<-as.numeric(Reduce('|', lapply(x[ICD], inj_type5)))
#*****************IDENTIFYING INJURY TYPE********************#

x$dxreason2<-ifelse(x$spec==1, "DM-specific", (ifelse(x$dm_com==1, "DM-Comorbidity-Only", ifelse(x$inj==1, "Injury-Only", "missing"))))
x$dxreason<-ifelse(x$inj==1, "Injury", ifelse(x$spec==1, "DM-specific", ifelse(x$dm_com==1, "DM-Comorbidity-Only", ifelse(x$inj_any==1, "Injury",  "missing"))))
chck9<-count(x$dxreason)
return(x)
}
```


```{r}
icd_10_var<-function(x){
ICD<-startsWith(colnames(x), "I10_DX")
ICD_prn<-startsWith(colnames(x), "I10_PR")
ketoacidosis<-c("E1010", "E1011", "E10641", "E1110", "E1111", "E11641", "E1310", "E1311", "E13641")
dm_coma_hyperosmo<-c("E1065", "E1100", "E1101", "E11641", "E1165", "E1300", "E1301", "E13641", "E1365")
dm_shorterm_ICD10<-c(ketoacidosis,dm_coma_hyperosmo)
rm(ketoacidosis,dm_coma_hyperosmo)
dm_renal<-c("E1021", "E1022", "E1029", "E1121", "E1122", "E1129", "E1321", "E1322", "E1329")
dm_opth<-c("E10311", "E10319", "E1136", "E11311", "E13321", "E11331", "E13329", "E13341", "E13349", "E11351", "E1339", "E13331", "E13339", "E1336", "E13351", "E1139", "E11321", "E11341", "E13359", "E103211", "E103212", "E103213", "E103219", "E1036", "E1033", "E10341", "E10351", "E133521", "E133522", "E133523", "E133529", "E133531", "E133532", "E133533", "E133539", "E133541", "E133542", "E133543", "E133549", "E13311", "E13319", "E133211", "E133212", "E133213", "E133219", "E133291", "E133292", "E133293", "E133299", "E133311", "E133312", "E133313", "E133319", "E133391", "E133392", "E133393", "E133399", "E133411", "E133412", "E133413", "E133419", "E133491", "E133492", "E133493", "E133499", "E133511", "E133512", "E133513", "E133519", "E133591", "E133592", "E133593", "E133599", "E1337", "E1037X1", "E1037X2", "E1037X3", "E1037X9", "E1039", "E13355", "E10329", "E10339", "E10349", "E10359", "E11319", "E11329", "E11339", "E11349", "E11359", as.character(paste0("E10", 340:349)), as.character(paste0("E11", 340:349)), as.character(paste0("E13", 340:349)), as.character(paste0("E10", 350:359)),as.character(paste0("E11", 350:359)), as.character(paste0("E13", 350:359)))
dm_neuro<-c("E1040", "E1041", "E1042", "E1043", "E1044", "E1049",  "E1140", "E1141", "E1142", "E1143", "E1144", "E1149", "E1340", "E1341", "E1343", "E1344", "E1349", "E10610", "E11610", "E13610")
dm_circ<-c("E1051", "E1052", "E1059", "E10610", "E10618", "E10620", "E10621", "E10622", "E10628","E1151", "E1152", "E1159", "E11610", "E11618", "E11620", "E11621", "E11622", "E11628", "E1351", "E1352", "E1359", "E13610", "E13618", "E13620", "E13621", "E13622", "E13628")
dm_unsp<-c("E1069", "E108", "E11630", "E11638", "E118", "E138", "E108")
dm_other<-c("E10630", "E10638", "E1169", "E118", "E13638", "E10622", "E10620", "E13618", "E13621", "E1069", "E13649", "E11628", "E10630", "E10618", "E13630", "E11620", "E10621", "E10638", "E10649", "E1169", "E13628", "E1369", "E13620", "E11622", "E11621", "E11649", "E11630", "E11618", "E10628", "E11638", "E13622")
dm_longterm_ICD10<-c(dm_renal, dm_opth, dm_neuro, dm_circ, dm_other)
rm(dm_renal, dm_opth, dm_neuro, dm_circ, dm_unsp,dm_other)
dm_uncon<-c("E1065", "E1165", "E10649", "E11649", "E1365")
#procedure codes
leau<-c("0Y620ZZ", "0Y630ZZ", "0Y640ZZ", "0Y670ZZ", "0Y680ZZ", "0Y6C0Z1", "0Y6C0Z2", "0Y6C0Z3", "0Y6D0Z1", "0Y6D0Z2", "0Y6D0Z3", "0Y6F0ZZ", "0Y6G0ZZ", "0Y6H0Z1", "0Y6H0Z2", "0Y6H0Z3", "0Y6J0Z1", "0Y6J0Z2", "0Y6J0Z3", "0Y6M0Z0", "0Y6M0Z4", "0Y6M0Z5", "0Y6M0Z6", "0Y6M0Z7", "0Y6M0Z8", "0Y6M0Z9", "0Y6M0ZB", "0Y6M0ZC", "06YM0ZD", "06YM0ZF", "06YN0Z0", "0Y6N0Z4", "0Y6N0Z5", "0Y6N0Z6", "0Y6N0Z7", "0Y6N0Z8", "0Y6N0Z9", "0YN0ZB", "0Y6N0ZC", "0Y6N0ZD", "0Y6N0ZF", "0Y6P0Z0", "0Y6POZ1", "0Y6POZ2", "0Y6P0Z3", "0Y6Q0Z0", "0Y6Q0Z1", "0Y6Q0Z2", "0Y6Q0Z3", "0Y6R0Z0", "0Y6R0Z1", "0Y6R0Z2", "0Y6R0Z3", "0Y6S0Z1", "0Y6S0Z2", "0Y6S0Z3", "0Y6T0Z0", "0Y6T0Z1", "0Y6T0Z2", "0Y6T0Z3", "0Y6U0Z0", "0Y6U0Z1", "0Y6U0Z2", "0Y6U0Z3", "0Y6V0Z0", "0Y6V0Z1", "0Y6V0Z2", "0Y6V0Z3", "0Y6W0Z0", "0Y6W0Z1", "0Y6W0Z2", "0Y6W0Z3", "0Y6X0Z0", "0Y6X0Z1", "0Y6X0Z2", "0Y6X0Z3", "0Y6Y0Z0", "0Y6Y0Z1", "0Y6Y0Z2", "0Y6Y0Z3", "0Y6TZ0", "0Y6T0Z1", "0Y6T0Z2", "0Y6T0Z3", "0Y6U0Z0", "0Y6U0Z1", "0Y6U0Z2", "0Y6U0Z3", "0Y6C0Z1", "0Y6C0Z2", "0Y6C0Z3", "0Y620ZZ", "0Y6J0Z1", "0Y6J0Z2", "0YJ0Z3")
#diagnosis codes
lower_ulc_infl_inf<-c("I183009", "183019", "183029", "L97909", "L02429", "L02439", "L02439", "L02629", "L02639", "L03039", "L03049", "L03129", "L03119", "L03119", "L03129", "M00059", "M00159", "M00259", "M00859", "M00069", "M00169", "M00269", "M00869", "M0007909", "M00179", "M00279", "M00879", "M86159", "M86259", "M86169", "M86269", "M86179", "M86279", "M86669", "M86679", "M869", "M90859", "M90869", "M90879", "I96")

#exclude and use Ginde et al. algorithm to describe
#hypogl<-c("E15", "E160", "E161", "E162", "E710", "E71120", "E7119", "E712", "P700", "P701", "P704", "T383X1A", "T383X2A", "T383X3A", "T383X4A", "E11618", "E11620", "E11621", "E11622", "E11628", "E11630", "E11638","E11649", "E1165", "E1169", "E348", "E7521", "E7522", "E75249", "E770", "E771", "L03029", "E11618", "E11620", "E11621", "E11622", "E11628", "E11630", "E11638", "E11649", "E1165", "L921", "L942", "L988", "M8610", "M8620", "M8660", "M869", "M9080", "E11641", "E1011", "E10641", "E1101", "E1165", "E1011", "E1065")
#ginde et al - need to update for when distinguishing ketoacidosis and hypoglycemia
hypo_rule1_3char<-c("E15")
hypo_rule1_4char<-c("E160", "E161", "E162", "E710", "E712", "P700", "P701", "P704")
hypo_rule1_5char<-c("E7119")
hypo_rule1_6char<-c("E71120")
hypo_rule2_char<-c("E11618", "E11620", "E11621", "E11622", "E11628", "E11630", "E11638","E11649", "E1165", "E1169")
hypo_rule3_char<-c("E348", "E7521", "E7522", "E75249", "E770", "E771", "L03029", "E11618", "E11620", "E11621", "E11622", "E11628", "E11630", "E11638", "E11649", "E1165", "L921", "L942", "L988", "M8610", "M8620", "M8660", "M869", "M9080")
#not used here
hypo_rule4_char<-c("E11641", "E1011", "E10641", "E1101", "E1165", "E1065", "E13641", "E1311", "E1301", "E1365")

hypo_rule1<-function(x){
hypo_1<-ifelse(substring(x, 1,3) %in% hypo_rule1_3char, 1, 0)
hypo_2<- ifelse(substring(x, 1,4) %in% hypo_rule1_4char, 1, 0)
hypo_3<-ifelse(substring(x, 1,5) %in% hypo_rule1_5char, 1, 0)
hypo_4<-ifelse(substring(x, 1,5) %in% hypo_rule1_6char, 1, 0)
hypo_rule1<-ifelse(hypo_1==1|hypo_2==1|hypo_3==1|hypo_4==1, 1, 0)
return(hypo_rule1)
}
x$hr1<-as.numeric(Reduce('|', lapply(x[ICD], hypo_rule1)))

hypo_rule2<-function(x){
hypo6<-ifelse(substring(x,1,5) %in% hypo_rule2_char, 1, 0)
return(hypo6)
}
x$hr2<-as.numeric(Reduce('|', lapply(x[ICD], hypo_rule2)))

hypo_rule3<-function(x){
hypo7<-ifelse(x %in% hypo_rule3_char, 1, 0)
return(hypo7)
}
x$hr3<-as.numeric(Reduce('|', lapply(x[ICD], hypo_rule3)))
x$hr4<-ifelse(x$hr2==1&x$hr3==0, 1,0)
x$hr5<-ifelse(x$hr1==1|x$hr4==1, 1,0)

hypo_rule4<-function(x){
  ifelse(x %in% hypo_rule4_char, 1, 0)
}
x$hr6<-as.numeric(Reduce('|', lapply(x[ICD], hypo_rule4)))
x$hypo<-ifelse(x$hr5==1 & x$hr6==0, 1, 0)
drop<-colnames(x)[startsWith(colnames(x), "hr")]
x[drop]<-NULL

diab_COMP_ICD10<-c(lower_ulc_infl_inf, dm_uncon)
rm(lower_ulc_infl_inf)

#ICD10, Diabetes Comorbidities
#from https://care.diabetesjournals.org/content/diacare/suppl/2018/03/20/dci18-0007.DC1/DCi180007SupplementaryData.pdf
neuro<-c("G733", "G737", "G608", "G5620", "G5642", "G5622", "G587", "G5690", "G5680", "G5612", 
         "G5610", "G580", "G5692", "G5630", "G5602", "G5632", "G5621", "G5682", "G5641", "G5600", 
         "G5691", "G5611", "G5640", "G5681", "G5601", "G5631", "G5780", "G5712", "G5732", "G5782",
         "G5700", "G5792", "G5702", "G5762", "G5721", "G5791", "G589", "G5770", "G5750",
         "G5761", "G5701", "G5740", "G5731", "G5752", "G5711", "G5781", "G5720", "G5772",
         "G5771", "G59", "G5722", "G588", "G5751", "G5742", "G5710", "G5790", "G5741", "G5760",
         "G5730", "G5643", "G5603", "G5693", "G5683", "G5713", "G5753", "G5773", "G5783",
         "G5793", "G589", "M14632", "M14629", "M14662", "M14649", "M14641", "M14612", "M14621",
         "M14611", "M14661", "M14669", "M1469", "M14619", "M14672", "M14642", "M14671",
         "M14652", "M14631", "M1468", "M14659", "M14622", "M14639", "M1460", "M14651",
         "M14679", "M14812", "M14819", "M14821", "M14822", "M14829", "M14831",
         "M14832", "M14839", "M14841", "M14842", "M14849", "M14851", "M14852",
         "M14859", "M14861", "M14862", "M14869", "M14871", "M14872", "M14879", "M1488",
         "M1489",  "G990", "E1042", "E1043", "E1142", "E1143", "E1342", "E1343", "M792", "M5418", "M5410", "M542", "M5400", "M5401", "M5402", "M5403", "M5404",
         "M5405", "M5406", "M5407", "M5408", "M5409", "M5481", "M5414", "M5415", "M5416",
         "M5417", "M545", "E1040", "E1041", "E1044", "E1049", "E1140", "E1141", "E1144", "E1149", "E1340",
         "E1341", "E1343", "E1344", "E1349", "E10610", "E11610", "E13610", "I6621", "I63313", "I63323", "I63429", "I63522", "I63432", "I63331", "I63333", "I63343",
         "I63542", "I63311", "I63449", "I63541", "I6349", "I6602", "I6612", "I63319", "I639", "I63412",
         "I6350", "I6629", "I6623", "I669", "I63521", "I663", "I63339", "I63411", "I63322", "I63342",
         "I668", "I63413", "I63419", "I63423", "I63433", "I63513", "I63529", "I63341", "I63321",
         "I63532", "I6611", "I6340", "I6613", "I6601", "I63431", "I63439", "I63312", "I6339", "I63512",
         "I63549", "I63422", "I638", "I63442", "I63349", "I6619", "I63329", "I63511", "I63523",
         "I63533", "I63543", "I636", "I63421", "I63519", "I63539", "I63531", "I6359", "I6603", "I6609",
         "I63441", "I63332", "I6622", "I6330", "I6031", "I6032", "I6002", "I6011", "I602", "I6050", "I604", "I6052", "I6051", "I6010", "I6012",
         "I6000", "I607", "I606", "I6030", "I608", "I609", "I610", "I611", "I612", "I613", "I614", "I615",
         "I616", "I618", "I619", "I6202", "I6203", "I6201", "I621", "I629", "I6200", "I69351",
         "I69090", "I69243", "I69041", "I69169", "I69943", "I69869", "I69021", "I69839",
         "I69923", "I69992", "I69965", "I69390", "I69265", "I69853", "I69221", "I69941", "I69354",
         "I69023", "I69120", "I69153", "I69944", "I69292", "I69244", "I69341", "I69092", "I69065",
         "I69049", "I69820", "I69262", "I69359", "I69044", "I69241", "I69142", "I69139", "I69223",
         "I69043", "I69062", "I69398", "I69322", "I69859", "I69962", "I69343", "I69949", "I69921",
         "I69321", "I69349", "I69822", "I69854", "I69122", "I69249", "I69842", "I69993", "I69344",
         "I69991", "I69851", "I69198", "I6920", "I69362", "I69963", "I69144", "I69093", "I69841",
         "I69064", "I69293", "I69232", "I69159", "I69151", "I69932", "I69233", "I69261", "I69898",
         "I69141", "I69032", "I69192", "I69063", "I69934", "I69890", "I69933", "I69031", "I69091",
         "I69228", "I69165", "I69154", "I69332", "I69121", "I69231", "I69323", "I69392", "I69252",
         "I69061", "I69123", "I69931", "I69928", "I69821", "I69862", "I6910", "I69823", "I69052",
         "I69865", "I69920", "I69143", "I6930", "I69393", "I69843", "I69264", "I69844", "I69028",
         "I69020", "I69969", "I69939", "I69964", "I69892", "I69291", "I69190", "I69952", "I69352",
         "I69033", "I69149", "I69832", "I69034", "I69361", "I69333", "I6900", "I69365", "I69331",
         "I69263", "I69334", "I69069", "I69364", "I69998", "I69922", "I69328", "I69022", "I69391",
         "I69234", "I69039", "I69849", "I69954", "I69953", "I69220", "I69961", "I69042", "I69951",
         "I6980", "I69363", "I69239", "I6990", "I69098", "I69164", "I69191", "I69833", "I69222",
         "I69831", "I69942", "I69861", "I69828", "I69054", "I69193", "I69269", "I69132", "I69959",
         "I69162", "I69863", "I69298", "I69051", "I69864", "I69161", "I69242", "I69342", "I69891",
         "I69259", "I69339", "I69369", "I69353", "I69290", "I69251", "I69163", "I69893", "I69131",
         "I69320", "I69852", "I69253", "I69152", "I69053", "I69990", "I69128", "I69059", "I69254",
         "I69134", "I69133", "I69834", "I69010", "I69011", "I69012", "I69013", "I69014", "I69015",
         "I69018", "I69019", "I69110", "I69111", "I69112", "I69113", "I69114", "I69115", "I69118",
         "I69119", "I69210", "I69211", "I69212", "I69213", "I69214", "I69215", "I69218", "I69219",
         "I69310", "I69311", "I69312", "I69313", "I69314", "I69315", "I69318", "I69319", "I69810",
         "I69811", "I69812", "I69813", "I69814", "I69815", "I69818", "I69819", "I69910", "I69911",
         "I69912", "I69913", "I69914", "I69915", "I69918", "I69919", "I6329", "I63239", "I63031", 
         "I63033", "I63013", "I63019", "I63219", "I63112", "I63113", "I6300", "I63132", "I63133", 
         "I6501", "I63111", "I6509", "I6312", "I6522", "I6302", "I6503", "I6320", "I63139", "I6319",
         "I63119", "I63131", "I63012", "I63039", "I6309", "I651", "I6529", "I63212", "I659", "I6502",
         "I63232", "I6521", "I658", "I63211", "I6310", "I63032", "I6523", "I63011", "I6322", "I63231", 
         "I63213", "I63233", "G468", "G466", "G467", "I675", "I672", "I674", "I6781", "I671", "G465", 
         "G464", "I679", "I676", "I688", "G463", "I6782", "I677", "I680", "G454", "I682", "I6789", 
         "G450", "G451", "G452", "G458", "G459", "G460", "G461", "G462", "I67848", "I67841")

pvd<-c("I70708", "I70301", "I70319", "I70369", "I70738", "I70303", "I70598", "I70543", "I7025",
                    "I70661", "I70245", "I70334", "I70432", "I70298", "I70518", "I70718", "I70613", "I708",
                    "I70768", "I70603", "I70633", "I70663", "I70743", "I70218", "I70628", "I70402", "I70568",
                    "I70345", "I70523", "I70268", "I70461", "I70508", "I70693", "I70411", "I70309", "I70399",
                    "I70723", "I70634", "I70339", "I70331", "I70669", "I70631", "I70549", "I7045", "I70541",
                    "I70639", "I70601", "I70609", "I70744", "I70242", "I70792", "I70521", "I70691", "I70741",
                    "I70413", "I70493", "I70243", "I70463", "I70619", "I70342", "I70431", "I70712", "I70244",
                    "I70491", "I70322", "I70419", "I70428", "I700", "I70448", "I70732", "I70535", "I70562",
                    "I70721", "I70699", "I70538", "I70648", "I70223", "I70544", "I70238", "I70439", "I70403",
                    "I70645", "I70221", "I70398", "I70499", "I70611", "I70433", "I7090", "I70749", "I70208",
                    "I70229", "I70323", "I70642", "I70592", "I70762", "I70308", "I70401", "I70529", "I70202",
                    "I70212", "I70222", "I70532", "I70512", "I70368", "I70341", "I70713", "I70638", "I70344",
                    "I70438", "I70513", "I70735", "I70434", "I70591", "I7035", "I70599", "I70442", "I70318",
                    "I70445", "I70643", "I70329", "I70502", "I70698", "I7065", "I70241", "I70731", "I70729",
                    "I70321", "I70793", "I70469", "I70701", "I7092", "I70528", "I70232", "I70763", "I70422",
                    "I70668", "I70349", "I70468", "I70548", "I70418", "I70733", "I70299", "I70711", "I70335",
                    "I70644", "I70262", "I70409", "I70343", "I70313", "I70533", "I70511", "I70213", "I70728",
                    "I70703", "I70608", "I70443", "I70519", "I70748", "I70261", "I70791", "I70362", "I70622",
                    "I70293", "I70263", "I70623", "I70569", "I70709", "I70769", "I70408", "I70761", "I70719",
                    "I70332", "I70302", "I701", "I70498", "I70702", "I70799", "I7075", "I70228", "I70201",
                    "I70534", "I70235", "I70234", "I70629", "I70501", "I70412", "I70291", "I70392", "I70292",
                    "I70641", "I70231", "I70692", "I70545", "I70621", "I70338", "I70219", "I70509", "I70722",
                    "I70561", "I70249", "I70734", "I70444", "I70539", "I70612", "I70441", "I70563", "I70531",
                    "I70449", "I70503", "I70593", "I70393", "I70211", "I70423", "I7055", "I70462", "I70312",
                    "I70618", "I70635", "I70361", "I70745", "I70328", "I70209", "I70742", "I70348", "I70492",
                    "I70233", "I70363", "I7091", "I70435", "I70522", "I70649", "I70602", "I70269", "I70542", 
                    "I70203", "I70421", "I70632", "I70333", "I70429", "I70391", "I70248", "I70739", "I70662",
                    "I70798", "I70239", "I70311", "I743", "I744", "I7401", "I749", "I7411", "I7409", "I7419", 
                    "I7410", "I748", "I742", "I745", "I771", "I7381", "I798", "I7389", "I7301", "I7779", "E0852",
                    "E0951", "I7772", "I7300", "E0851", "E0859", "E0952", "E0959", "I731", "I791", "I7774", 
                    "I7773", "I7771", "I739", "I670", "I87339", "I87022", "I87322", "I87309", "I998", "I87021", "I872", "I87029", "I87092",
                    "I87023", "I87392", "I87012", "I87321", "I871", "I87302", "I87093", "I87323", "I87329",
                    "I87033", "I87013", "I87001", "I87002", "I87032", "I87312", "I87091", "I87003", "I87099",
                    "R58", "I879", "I87303", "I87011", "I87311", "I87332", "I87393", "I999", "I87039", "I87009",
                    "I87019", "I87301", "I87333", "I87031", "I87319", "I87391", "I87399", "I878", "I87331",
                    "I87313", "I8010", "I80223", "I8000", "I80221", "I80292", "I80202", "I80232", "I80212", "I8002", "I803",
                    "I8012", "I809", "I80229", "I80213", "I80219", "I80233", "I80211", "I80293", "I80231",
                    "I8013", "I8001", "I80201", "I80239", "I8011", "I80203", "I80291", "I80209", "I80299", "I808",
                    "I80222", "I8003", "I81", "I82719", "I8290", "I82599", "I82A29", "I82701", "I82291", "I82441", "I82A21", "I82711",
                    "I82C22", "I825Z3", "I82511", "I82539", "I82211", "I825Z9", "I82501", "I824Y2", "I82A12",
                    "I82533", "I82519", "I82612", "I82623", "I825Z1", "I82629", "I82C21", "I82503", "I82709",
                    "I82443", "I82703", "I82412", "I82602", "I82531", "I82542", "I82492", "I82621", "I82449",
                    "I82890", "I82A13", "I82522", "I82603", "I82509", "I82613", "I82B22", "I82421", "I82220",
                    "I824Z2", "I82423", "I82C23", "I82812", "I82722", "I8291", "I820", "I82429", "I82C29",
                    "I82811", "I824Z3", "I82611", "I825Y2", "I82543", "I82523", "I82B21", "I824Y9", "I82B12",
                    "I82432", "I82A11", "I82413", "I82521", "I82402", "I82493", "I82601", "I82B23", "I82433",
                    "I82491", "I82A19", "I82541", "I824Y3", "I825Y1", "I82729", "I82C13", "I82819", "I824Z9",
                    "I82403", "I82C12", "I82419", "I82721", "I82512", "I82B13", "I82C11", "I824Y1", "I82431",
                    "I82C19", "I821", "I82A22", "I82549", "I82290", "I82B29", "I82619", "I82411", "I82221",
                    "I824Z1", "I82813", "I82702", "I82529", "I82592", "I82891", "I82723", "I82210", "I82609",
                    "I825Z2", "I82532", "I823", "I82499", "I82422", "I82409", "I82622", "I82442", "I82B19",
                    "I82A23", "I82713", "I82502", "I82439", "I825Y3", "I82B11", "I82593", "I82401", "I82712",
                    "I82591", "I82513", "I825Y9", "I83024", "I83212", "I83015", "I83215", "I83021", "I83005", "I83012", "I83029", "I83202",
                    "I8390", "I83228", "I83013", "I8310", "I83205", "I83002", "I83203", "I83229", "I83001",
                    "I8392", "I83219", "I83812", "I83214", "I83892", "I83003", "I83213", "I83011", "I83004",
                    "I83014", "I83211", "I83028", "I83009", "I83201", "I83225", "I83222", "I83008", "I83019",
                    "I8312", "I83813", "I83209", "I8311", "I83891", "I83893", "I83025", "I83204", "I83899",
                    "I83018", "I8391", "I83208", "I83811", "I83023", "I83221", "I8393", "I83218", "I83022",
                    "I83223", "I83819", "I83224", "I96", "S68019A", "S68011A", "S68511A", "S68519A", "S68022A", "S68029A",
                    "S68522A", "S68021A", "S68012A", "S68512A", "S68521A", "S68529A", "S68126A",
                    "S68626A", "S68629A", "S68621A", "S68123A", "S68128A", "S68614A", "S68129A",
                    "S68612A", "S68120A", "S68114A", "S68121A", "S68628A", "S68620A", "S68127A",
                    "S68112A", "S68623A", "S68611A", "S68125A", "S68111A", "S68113A", "S68110A",
                    "S68616A", "S68619A", "S68618A", "S68118A", "S68116A", "S68627A", "S68119A",
                    "S68622A", "S68122A", "S68613A", "S68124A", "S68624A", "S68617A", "S68115A",
                    "S68117A", "S68610A", "S68625A", "S68615A", "S68429A", "S48021A", "S68412A",
                    "S58111A", "S58911A", "S68421A", "S58919A", "S48122A", "S48922A", "S48029A",
                    "S58021A", "S68719A", "S68411A", "S68711A", "S58922A", "S58119A", "S68722A",
                    "S48012A", "S58029A", "S48929A", "S58012A", "S68419A", "S48019A", "S48121A",
                    "S68422A", "S58122A", "S48129A", "S48112A", "S58019A", "S58112A", "S48921A",
                    "S68721A", "S48011A", "S48912A", "S58929A", "S58921A", "S58912A", "S48919A",
                    "S58129A", "S68729A", "S58121A", "S48111A", "S48911A", "S48119A", "S58022A",
                    "S58011A", "S68712A", "S48022A", "S98122A", "S98211A", "S98219A", "S98222A",
                    "S98132A", "S98121A", "S98212A", "S98229A", "S98142A", "S98129A", "S98131A",
                    "S98112A", "S98221A", "S98139A", "S98149A", "S98141A", "S98119A", "S98111A",
                    "S98029A", "S98922A", "S98021A", "S98319A", "S98311A", "S98912A", "S98929A", 
                    "S98012A", "S98019A", "S98322A", "S98921A", "S98011A", "S98911A", "S98022A",
                    "S98321A", "S98919A", "S98312A", "S98329A", "S78022A", "S88011A", "S88121A",
                    "S88112A", "S78911A", "S78919A", "S88022A", "S88111A", "S78111A", "S78119A",
                    "S88919A", "S88119A", "S88029A", "S88922A", "S78122A", "S88911A", "S78029A",
                    "S88021A", "S78021A", "S78012A", "S88122A", "S78912A", "S78929A", "S88012A",
                    "S78922A", "S78921A", "S78112A", "S78019A", "S78121A", "S88929A", "S88129A",
                    "S78011A", "S88019A", "S78129A", "S88912A", "S88921A", "L97512", "L89100", 
                    "L89013", "L97119", "L89624", "L97804", "L97101", "L97403",
                    "L89810", "L89014", "L97322", "L89520", "L97104", "L89329", "L89110", "L97419",
                    "L89519", "L89600", "L8993", "L89501", "L97223", "L97819", "L97404", "L89509",
                    "L97803", "L89621", "L89203", "L97411", "L97924", "L89302", "L97109", "L89629",
                    "L89504", "L89143", "L89149", "L97921", "L97414", "L89602", "L97401", "L97524",
                    "L8991", "L89213", "L97502", "L97809", "L89150", "L89004", "L97801", "L97221",
                    "L89522", "L97529", "L89123", "L97224", "L89204", "L89141", "L89214", "L97103",
                    "L89311", "L89211", "L98422", "L89019", "L89892", "L97521", "L89613", "L89219",
                    "L89132", "L89209", "L89020", "L89130", "L97212", "L89001", "L89314", "L97511",
                    "L89812", "L89144", "L97902", "L97122", "L97409", "L89201", "L89003", "L89603",
                    "L97912", "L97929", "L8994", "L89313", "L89220", "L89129", "L89112", "L89303",
                    "L89893", "L89011", "L97202", "L89222", "L89500", "L89102", "L97501", "L89113",
                    "L89124", "L97503", "L89009", "L89891", "L97923", "L89612", "L89121", "L97123",
                    "L89601", "L89894", "L89811", "L97213", "L98492", "L89119", "L89614", "L97513",
                    "L97514", "L97422", "L8942", "L97229", "L98429", "L89521", "L97822", "L89134",
                    "L89814", "L89301", "L8940", "L98423", "L89114", "L97914", "L97919", "L89322",
                    "L89131", "L89152", "L97913", "L89813", "L89319", "L97312", "L97324", "L97321",
                    "L8945", "L89529", "L89604", "L97323", "L89103", "L97121", "L89320", "L89523",
                    "L89022", "L89899", "L98424", "L89524", "L97911", "L97124", "L89101", "L89619",
                    "L97812", "L89512", "L97424", "L97821", "L89309", "L97302", "L97519", "L89200",
                    "L97412", "L97211", "L97329", "L89010", "L89133", "L98412", "L97909", "L89310",
                    "L89109", "L97823", "L89153", "L89139", "L89304", "L98421", "L97102", "L89609",
                    "L89622", "L97504", "L97214", "L98413", "L97423", "L89510", "L89111", "L89620",
                    "L89104", "L97903", "L97303", "L97201", "L97829", "L97203", "L97311", "L89819",
                    "L89000", "L89323", "L97509", "L89611", "L97314", "L89023", "L97209", "L98491",
                    "L97522", "L97824", "L89151", "L89140", "L89210", "L97802", "L89122", "L89154",
                    "L89120", "L8944", "L89223", "L89142", "L89221", "L97301", "L8941", "L97313", "L8992",
                    "L98411", "L89224", "L97129", "L89012", "L98493", "L97114", "L8943", "L97429",
                    "L97219", "L97112", "L97922", "L97421", "L97813", "L97111", "L89029", "L98494",
                    "L97204", "L97222", "L89502", "L89229", "L89321", "L97413", "L98499", "L89212",
                    "L97304", "L8990", "L97402", "L97904", "L89312", "L89324", "L89021", "L89503",
                    "L97901", "L98414", "L97319", "L97523", "L89610", "L89002", "L89159", "L89513",
                    "L89511", "L89514", "L8995", "L98419", "L89890", "L89202", "L97309", "L89623",
                    "L97113", "L89024", "L97811", "L97814", "L89300")

cvd<-c("I718", "I790", "I716", "I7103", "I715", "I712", "I7101", "I714", "I713", "I719", "I7100", "I7102", "I711", "I724", "I721", "I723", "I729", "I720", "I728", "I722","I951", "I9589", "I959", "I953", "I950", "I952", "I9581", "I25708", "I25738", "I209", "I25721", "I25729", "I25791", "I208", "I25728", "I25731", "I25701", "I25719", "I25799", "I25711", "I25739", "I201", "I25709", "I25798", "I25718","I25700", "I25710", "I25720", "I25730", "I25750", "I25760", "I25790" , "I25751", "I25758", "I25759", "I2518", "I4430", "I4519", "I4581", "I4589", "I450", "I4460", "I440", "I4510", "I442", "I447", "I445", "I452", "I455", "I4469", "I459", "I454", "I453", "I4439","I444", "I441", "I456", "I4940", "I482", "I4901","I4892", "I470", "I472", "I499", "I493", "I491", "I481", "I484", "I483", "I469", "I479", "I471", "I4891", "R001", "I468", "I4949", "I498", "I495", "I492", "I480", "I4902", "I462", "I2510", "I517", "I428", "I426", "I427", "I420", "I425", "I422", "I421", "I424", "I43", "I429", "I423", "I249", "I241", "I200", "I248", "I240", "I5020", "I5040", "I5031", "I5022", "I5042", "I5043", "I5021", "I5023", "I5030", "I5041", "I5032", "I501", "I509", "I5033", "I515", "I222", "I2121", "I2102", "R0989", "I2111", "I213", "I229", "I214", "I2101", "I221", "I2129", "I2119", "I220", "I2109", "I228", "I252", "I253", "I25111", "I2584", "I2583", "I25119", "I2589", "I25811", "I259", "I2542", "I25118", "I256", "I25110", "I25812", "I2541", "I2582", "I25810", "I25761", "I25769", "I25768", "I255", "I10", "I119", "I110", "I120", "I129", "I1311", "I130", "I1310", "I132", "I152", "I150", "I151", "I159", "I158")

renal<-c("N118", "N136", "N110", "N2886", "N119", "N111", "N10", "N2885", "N12", "N2884", "N151", "N323", "N321", "N329", "N312", "N99518", "N33", "N99510", "N319", "N3644", "N320","N311", "N99511", "N99512", "N322", "N3289", "N3281", "N310", "N318", "N3090", "N3030", "N3010", "N3041", "N3000", "N3021", "N3080", "N3091", "N3040", "N3081", "N3031","N3011", "N3020", "N3001","N261", "N262", "N269", "N005", "N011", "N013", "N014", "N002", "N001", "N003", "N009", "N018", "N004", "N019", "N006", "N008", "N010", "N016", "N017", "N007", "N015", "N000", "N012", "N029", "N046","N026", "N048", "N028", "N027", "N040", "B520", "N047", "N025", "N020", "N045", "N042", "N044", "N022", "N024", "N043", "N023", "N021", "N049", "N041", "N035", "N032", "N031","N033", "N039", "N034", "N038", "N036", "N030", "N037", "N070", "N056", "N057", "N143", "N050", "N058", "N077", "N064", "E0922", "N063", "N072", "N141", "N144", "N159", "N158", "N069", "N053", "N075", "N073", "N052", "N071", "N055", "N061", "N150", "N16", "N079", "E0929", "N08", "N066", "N051", "N054", "N067", "N060", "N078", "N068", "N074", "N142", "N059", "N140", "N062", "N076", "N065", "R808", "R800", "R801", "R803", "R809", "N179", "N178", "N170", "N172", "N171", "N19", "N250", "N2581", "N251", "N2589", "N259", "N13732", "N13729", "N2889", "N138", "N135", "N281", "N289", "N13731", "N1370", "R802", "N13739", "N134", "N13722", "N2882", "N1371", "N29", "N2881", "N280", "N2883", "N13721", "N390", "N185", "N186", "N182", "N183", "N181", "N189", "N184")

metabol<-c("E739", "E7402", "E7253", "E7411", "E7419", "E738", "E7409", "E744", "E7403", "E7431", "E730", "E7401", "E7420", "E7404", "E749", "E7412", "E7439", "E7421", "E748", "E7400", "E7252", "E7429", "E7410", "E731", "E7250", "E7251", "E7259", "E7800", "E7801", "E783", "E875", "E781", "C880", "E43", "E41", "E753", "E771", "E75240", "E7521", "E75242", "E779", "E75241", "E75243", "E75249", "E778", "E770", "E75248", "E7500", "E7501", "E7502", "E7509", "E7510", "E7511", "E7519", "E756", "E755", "E7522", "E341", "E348", "E349", "E784", "E785", "E782", "E748")

opthal<-c("G453", "H31101", "H31102", "H31103", "H31109", "H31111", "H31112", "H31113", "H31119", "H31121", "H31122", "H31123", "H31129", "H3400", "H3401", "H3402", "H3403", "H3410", "H3411", "H3412", "H3413", "H34211", "H34212", "H34213", "H34219", "H34231", "H34232", "H34233", "H34239", "H348110", "H348111", "H348112", "H348120", "H348121", "H348122","H34813", "H348190", "H348191", "H348192", "H34821", "H34822", "H34823", "H34829", "H348310", "H348311", "H348312", "H348320", "H348321", "H348322", "H348330", "H348331", "H348332", "H348390", "H348391", "H348392", "H349", "H3500", "H35011", "H35012", "H35013", "H35019", "H35021", "H35022", "H35023", "H35029", "H35031", "H35032", "H35033", "H35039", "H35041", "H35042", "H35043", "H35049", "H35051", "H35052", "H35053", "H35059", "H35061", "H35062", "H35063", "H35069", "H35071", "H35072", "H35073", "H35079", "H3509", "H35101", "H35102", "H35103", "H35109", "H35111", "H35112", "H35113", "H35119", "H35121", "H35122", "H35123", "H35129", "H35131", "H35132", "H35133", "H35139", "H35141", "H35142", "H35143", "H35149", "H35151", "H35152", "H35153", "H35159", "H35161", "H35162", "H35163", "H35169", "H35171", "H35172", "H35173", "H35179", "H3520", "H3521", "H3522", "H3523", "H3530",  "H353110", "H353111", "H353112", "H353113", "H353114", "H353120", "H353121", "H353122", "H353123", "H353124", "H353130", "H353131", "H353132", "H353133", "H353134", "H353190", "H353191", "H353192", "H353193", "H353194", "H353210", "H353211", "H353212", "H353213", "H353220", "H353221", "H353222", "H353223", "H353230", "H353231", "H353232", "H353233", "H353290", "H353291", "H353292", "H353293", "H3533", "H35341", "H35342", "H35343", "H35349", "H35351", "H35352", "H35353", "H35359", "H35361", "H35362", "H35363", "H35369", "H35371", "H35372", "H35373", "H35379", "H35381", "H35382", "H35383", "H35389", "H3540", "H35411", "H35412", "H35413", "H35419", "H35421", "H35422", "H35423", "H35429", "H35431",  "H35432", "H35433", "H35439", "H35441", "H35442", "H35443", "H35449", "H35451", "H35452", "H35453", "H35459", "H35461", "H35462", "H35463", "H35469", "H3550", "H3551", "H3552",  "H3553", "H3554", "H3560", "H3561", "H3562", "H3563", "H3570", "H35711", "H35712", "H35713", "H35719", "H35721", "H35722", "H35723", "H35729", "H35731", "H35732", "H35733", 
"H35739", "H3581", "H3582", "H3589", "H359", "H36", "H31001", "H31002", "H31003", "H31009", "H31011", "H31012", "H31013", "H31019", "H31021", "H31022", "H31023", "H31029", "H31091", "H31092", "H31093", "H31099", "H3120", "H3121", "H3122", "H3123", "H3129", "H31301", "H31302", "H31303", "H31309", "H31311", "H31312", "H31313",  "H31319", "H31321", "H31322", "H31323", "H31329", "H31401", "H31402", "H31403", "H31409", "H31411", "H31412", "H31413", "H31419", "H31421",  "H31422", "H31423", "H31429", "H318", "H319", "H31129", "H21352", "H2020", "H21319", "H21303", "H21253", "H21523", "H20012", "H21273", "H21309", "H21251", "H20029", "H2182", "H21242", "H21529", "H2022", "H21259", "H21543", "H2181", "H20021", "H21521", "H21342", "H2102", "H21322", "H21562", "H21301", "H21559", "H21223", "H21512", "H21541", "H21351",  "H21549", "H20049", "H21271", "H20013", "H21241", "H20032", "H21249", "H21222", "H20812", "H21212", "H20823", "H20822", "H20011", "H21221", "H21353", "H21279", "H2140", "H21323", "H21359", "H20829", "H20031", "H21243", "H2021", "H20821", "H21532", "H21262", "H2010", "H21229", "H2103", "H21232", "H20811", "H20039", "H219", "H2189", "H21561", "H21321", "H21502", "H20033", "H21349", "H21511", "H21341", "H21563", "H2000", "H20052", "H2101", "H21569", "H21272", "H21312", "H22", "H211X2", "H209", "H20019", "H21533", "H21501", "H21343", "H20022", "H2142", "H21231", "H2013", "H20042", "H2141", "H20051", "H21552", "H20053", "H211X1", "H21513", "H2023", "H20813", "H21211", "H21213", "H21531", "H20819", "H21233", "H21519", "H21553", "H21239", "H21329", "H211X3", "H2100", "H21522", "H21503", "H21539", "H21542", "H21219", "H2012", "H20043", "H20059", "H2011", "H21263", "H21302", "H21269", "H21313", "H21252", "H20023", "H20041", "H21509", "H2143", "H21551", "H2129", "H211X9", "H21261", "H21311", "H47521", "H47339", "H4710", "H47631", "H4741", "H47022",
"H4749", "H4601", "H4712", "H4603", "H479", "H47639", "H47322", "H47642", "H4743", "H468", "H47619", "H47622", "H47023", "H47142", "H47529", "H47512", "H47292", "H47029", "H4610", "H47392", "H4711", "H47321", "H47532", "H4713", "H47213", "H47212", "H47012", "H47531", "H47091", "H47021",
"H47629", "H47312", "H47511", "H47032", "H47323", "H4720", "H4600", "H47291", "H47232", "H47211", "H4612", "H47293", "H47522", "H47033", "H47519", "H47329", "H47649", "H47233", "H462", "H47313", "H47143", "H47332", "H47092", "H47612", "H47632", "H47231", "H47099", "H47093", "H47149", "H4613", "H47391", "H47393", "H47013", "H47539", "H47641", "H47621", "H4602", "H4742", "H47333", "H47219", "H47239", "H4722", "H47011", "H47319", "H4611", "H469", "H47311", "H47019", "H47299", "H47141", "H47399", "H47039", "H47611", "H47031", "H463", "H47331","H26132", "H2522", "H26239", "H26413", "H26493", "H26222", "H26051", "H26113", "H25043", "H26039", "H26042", "H25819", "H28", "H25041", "H26053", "H26131", "H26102", "H2523", "H26133", "H26491", "H2510", "H2512", "H25012", "H26111","H26411", "H2620", "H2631", "H2640", "H25049", "H2633", "H26223", "H26009", "H26101", "H26419", "H26221", "H26119", "H26059", "H2521", "H26062", "H26499", "H25033", "H26043", "H25093", "H26122", "H2609", "H25092", "H269", "H26041", "H26229", "H26139", "H25812", "H26103", "H25031", "H25013", "H26049", "H25032","H26032", "H25019", "H26232", "H26212", "H26002", "H26012", "H25011", "H2511", "H25091", "H26109", "H26013", "H2513", "H2520", "H26019", "H25099", "H26063", "H259", "H25813", "H26233", "H26129", "H2589", "H26052", "H2630", "H26121", "H26219", "H26231", "H25042", "H26031", "H26492", "H26069", "H26033", "H26412", "H26001", "H26112", "H26123", "H26213", "H26061", "H26211", "H26003", "H25811", "H268", "H2632", "H26011", "H25039", "H4043X4", "H40811", "H4060X1", "H401330", "H402210", "H4051X1", "H401390", "H4020X4", "H401310", "H4051X4", "H401321", "H4020X1", "H40819", "H401212", "H40243", "H4041X2", "H40051", "H4063X3", "H4062X4", "H40022", "H40059",
"H4061X2", "H4030X2", "H4033X2", "H4032X2", "H40241", "H402292", "H401324", "H4011X2", "H401292", "H4033X0", "H401422", "H402223", "H40831", "H402224", "H40043", "H4063X4", "H4043X3", "H409", "H40041", "H402230", "H40839", "H40833", "H4032X4", "H401392", "H4052X0", "H4041X3", "H40021", "H4041X1", "H401294",  "H4050X0", "H4060X4", "H401490", "H4030X3", "H401213", "H401312", "H4011X3", "H40151", "H401214", "H4020X3", "H4051X3", "H4011X1", "H4063X1", "H401423", "H401293", "H402212", "H402232", "H4061X3", "H4032X1", "H401424", "H401492", "H40249", "H402293", "H401410", "H4031X2", "H40232", "H4030X4", "H4031X0", "H4043X1", "H402221", "H401232", "H4032X3", "H401334", "H4061X4", "H40023", "H402213", "H40159", "H40049", "H401233", "H4041X4", "H42", "H4033X1", "H401291", "H4061X1", "H40821", "H401412", "H401323", "H401394", "H401333", "H40011", "H4052X2", "H40152", "H401220", "H402214", "H401211", "H4062X0", "H4050X2", "H401421", "H40212", "H401314", "H401432", "H4010X0", "H40153","H4060X2", "H401231", "H40029", "H401311", "H40213", "H40233", "H40032", "H401391", "H40823", "H4053X0", "H40211", "H4033X4", "H402291", "H4060X0", "H40052", "H401222", "H40063", "H402234", "H401493", "H401331","H401313","H4042X2", "H401491", "H4011X4", "H4030X1", "H401430", "H4062X2", "H4053X2", "H40822", "H401393", "H40069", "H401210", "H402211", "H40012", "H40013", "H40002", "H401332", "H4031X4", "H4042X0", "H4051X0", "H4043X0", "H401411", "H40061", "H40062", "H401414", "H4031X1", "H40019", "H4040X2", "H401494", "H4033X3", "H402233", "H401234", "H4062X3", "H401434", "H402231", "H4010X2", "H402220", "H40832", "H40033", "H4011X0", "H40231", "H4020X0", "H4042X3", "H4043X2", "H4050X4", "H401413", "H4040X3", "H40003", "H4061X0", "H40239", "H40009", "H401431", "H4062X1", "H4051X2", "H40829", "H4031X3", "H4052X3", "H402222", "H4020X2", "H4030X0", "H4042X1", "H40031", "H4040X0", "H4063X0","H4041X0", "H402294", "H401223", "H4052X1", "H40219", "H4032X0", "H4053X4", "H401320", "H401433", "H401221", "H40001", "H401230", "H401290", "H4063X2", "H40053", "H4052X4", "H4053X1", "H40039", "H4040X4", "H4010X1", "H4050X1", "H401224", "H401322", "H4042X4", "H4089", "H40042", "H4040X1", "H401420", "H4050X3", "H4060X3", "H4010X3", "H40242", "H40813", "H4010X4", "H4053X3", "H40812", "H402290", "H5359", "H5351", "H53439", "H53012", "H53122", "H53489", "H532", "H5354", "H53453", "H53021", "H5310", "H5316", "H5360", "H53422", "H5330", "H53142", "H53029", "H53459", "H53032", "H5362", "H53451", "H5315", "R441", "H53123", "H53141", "H53421", "H53011", "H53001", "H53002", "H53143", "H53121", "H53149", "H539", "H5332", "H53033", "H53423", "H53009", "H53003", "H53013", "H53412", "H5372", "H53432", "H5355", "H5311", "H5350", "H53429", "H5334", "H5361", "H53132", "H53129", "H538", "H5331", "H53413", "H53039", "H5352", "H53131", "H53462", "H53019", "H53031", "H53133", "H5340", "H53482", "H5319", "H5347", "H5333", "H53481", "H53452", "H5363", "H53022", "H53469", "R483", "H53139", "H53483", "H53433", "H5369", "H53419", "H5371", "H53431", "H53411", "H53461", "H53023", "H5353", "H5440", "H548", "H5442", "H547", "H540", "H5451", "H542", "H5460", "H5410", "H5412", "H5462", "H5441", "H5461", "H5450", "H5411", "H543", "H5452")

other<-c("R7881", "B372", "M86679", "M86479", "M86572", "M86471", "M86571", "M86372", "M86579", "M86371", "M868X7", "M86672", "M86671", "M86379", "M86472", "K5289", "K529", "N5201", "N5202", "N5203", "N521", "N522", "N5231", "N5232", "N5233", "N5234", "N5239", "N528", "N529", "H603", "H6000", "H6010", "H60319", "H60329", "H60399", "H6193", "H60339", "H6240", "H6020",  "H628X1", "H60399", "L921", "L942", "L988", "B373", "L03022", "L03041", "L03029", "L03012", "L03021", "L03011", "L03031", "L03032", "L03019", "L03049", "L03039", "L03042", "L03811", "L03114", "L03126", "L03891", "L03322", "L02212", "L03325", "L03221", "L02818", "L03119", "L03111", "L0390", "L03212", "L03317", "L03323", "L02213", "L03316", "L0211", "L02511", "L0291", "L02215", "L0201", "L03818", "L03125", "L02219", "L02214", "L03116", "L02415", "L02211", "L03329", "L0391", "L02612", "L0231", "L03898", "L02519", "L02412", "L02416", "L03124", "L03123", "L03314", "L03315", "L03122", "L03211", "L03324", "L03121", "L03112", "L03321", "L02611", "L03115", "L983", "L02811", "L03129", "L03312", "L02413", "L02216", "L02419", "L03311", "L03222", "L02411", "L02512", "L03326", "L02414", "L03113", "L03319", "L03327", "L02619", "L03313", "k122", "L03213", "M90852", "M90839", "M90869", "M90872", "M90831", "M90871", "M90822", "M9089", "M9088", "M90851", "M90819", "M90842", "M90821", "M9080", "M90879", "M90812",
"M90841", "M90862", "M90859", "M90832", "M90829", "M90849", "M90861", "M90811", "K3184")


#comorbid
acute_coronory<-c("I240", "I248", "I249")
acute_myocardial<-c("I21", "I210", "I211", "I212", "I213", "I214", "I219", "I22", "I220", "I221", "I228", "I229", "I23", "I230", "I231", "I232", "I233", "I234", "I235", "I236", "I238")
angina<-c("I200", "I201", "I208", "I209", "R071", "R072", "R0781", "R0782", "R0789", "R079")
arrythmia<-c("I4901", "I4902", "I491", "I492", "I493", "I4940", "I4949", "I495", "I498", "I499", "R000", "R001", "R002", "R008", "R009")
CABG_carot_claudic_revasc<-c("I63139", "I63239", "I658", "I6359", "G459", "I67848", "H3400", "I63019", "I63119", "I63139", "I6320", "I63219", "I6322", "I63239", "I6330", "I6340", "I6350", "I63509", "I651", "I6529", "I659", "I69898", as.character(paste0("I699", 20:98), "I97710", "I97790", "I97811", "I97821", "I9788", "I9789", "J810", "J951", "J952", "J953", "J95821", "J95822", "J95851", "J95859", "J9588", "J9600", "J9620", "K559", "K5660", "K6811", "K913", "K9181", "K9182", "K9183", "K9186", "K9189", "N135", "N289", "N9989", "R250", "R253", "R259", "R29890", "T81710A", "T81711A", "T81718A", "T8172XA", "T81710A", "T81711A", "T81718A", "T8172XA"))
CABG_proccode<-c("03CH0ZZ", "03CH3ZZ", "03CH4ZZ", "03CJ0ZZ", "03CH3ZZ", "03CJ4ZZ", "03CK0ZZ", "03CK3ZZ", "03CK4ZZ", "03CL0ZZ", "03CL3ZZ", "03CL4ZZ", "03CM0ZZ", "03CM3ZZ", "03CM4ZZ", "03CN0ZZ", "03CN3ZZ", "03CN4ZZ", "03CP0ZZ", "03CP3ZZ", "03CP4ZZ", "03CQ0ZZ", "03CQ3ZZ", "03CQ4ZZ", "03CR0ZZ", "03CR3ZZ", "03CR4ZZ", "03CS0ZZ", "03CS3ZZ", "03CS4ZZ", "03CT0ZZ", "03CT0ZZ", "03CT3ZZ", "O3CT4ZZ", 
"03CU0ZZ", "03CU3ZZ", "03CU4ZZ", "03CV3ZZ", "03CV4ZZ", 
" I7051", "I70511", "I70512", "I70518", "I70519", "I7061A", "I7071", "I7041", "I7031", "I7021", "I878", "I739", as.character(paste0("G819", 0:4)), "G9781", "G9782", "I509", "I6359", "I658", "I6609", "I6619", "I6629", "I669", "I69928", "I69998", "J9689", "K550", "R001", as.character(paste0("G81", 00:04)), as.character(paste0("G81", 10:14)), "G970", "H3400", "H53129", "I469", "I471", "I4891", "I4892", "I4901", "I4902", "I495", "I498", "I499",  as.character(paste0("I50", 1:4)), as.character(paste0("I50", 20:43)))
heart_fail<-c("I501", "I5020", "I5021", "I5022", "I5023", "I5030", "I5031", "I5032", "I5033", "I5040", "I5041", "I5042", "I5043", "I509")
pad_pvd<-c("I724", as.character(paste0("I7021", c(1,2,3,8,9))), "I7389", as.character(paste0("S913", c(51,52,59,621)), "A480", "I743", "I96"))
stroke<-c("I6000", "I6001", "I6002", "I6010", "I6011", "I6012", "I6020", "I6021", "6022", "I6030", "I6031", "I6032", "I604", "I6050", "I6051", "I6052", "I606", "I606", "I607", "I6789", "I608", "I609", "I610","I611", "I612", "I613", "I614", "I615", "I616", "I618", "I619", "I6200", "I6201", "I6202", "I6203", "I621", "I629", "I6300", "I63011", "I63012", "I63019", "I6302", "I63031", "I63032", "I63039", "I6309", "I6310", "I63111", "I63112", "I63119", "I6312", "I63131", "I63132", "I63139", "I6319", "I6320", "I63211", "I63219", "I6322", "I63231", "I63232", "I63239", "I6329", "I6330", "I63311", "I63312", "I63319", "I63321", "I63322", "I63329", "I63331", "I63332", "I63339", "I63341", "I63342", "I63349", "I6339", "I6340", "I63411", "I63412", "I63419", "I63421", "I63422", "I63429", "I63431", "I63432", "I63439", "I63441", "I63442", "I63449", "I6349", "I6350", "I63511", "I63512", "I63519", "I63521", "I63522", "I63529", "I63531", "I63532", "I63539", "I63541", "I63542", "I63549", "I6359", "I636", "I638", "I639") 
retinopathy<-c(as.character(paste0("H33", 000:999)),
               as.character(paste0("H330", 0:9)),
               as.character(paste0("H3535", 0:9)),
               as.character(paste0("H358", 0:9)), "H359",
               as.character(paste0("H431", 00:99)),
               as.character(paste0("H431", 000:999)),
               as.character(paste0("H431", 00:99))
)

depress<-c("F321", "F322", "F329", "F331", "F332", "F419", "F410", "F411", "F418", "F4001", "F4002", "F4010", "F40250", "F40241", "F408", "F42", "F341", "F481", "F4521", "F4522", "F450", "F451", "F459", "F458", "F488", "F489", "F99", "F430", "R457", "F4321", "F4322", "F4323", "F4329", "F948", "F4324", "F4325", "F4310", "F4312", "F438", "F4320", "F329", "R45851")
#add obesity, gout, hypertension, pneumonia, osa
obesity<-c("E6601", "E6609", "E661", "E662", "E668","E669","O99210",
"O99211","O99212","O99213","O99214","O99215","Z6830","Z6831","Z6832","Z6833","Z6834","Z6835", "Z6836","Z6837","Z6838", "Z6839","Z6841","Z6842","Z6843","Z6844","Z6845","Z6854")
gout<-c(	"M1000",	"M10011",	"M10012",	"M10019",	"M10021",	"M10022",	"M10029",	"M10031",	"M10032",	"M10039",	"M10041",	"M10042",	"M10049",	"M10051",	"M10052",	"M10059",	"M10061",	"M10062",	"M10069",	"M10071",	"M10072",	"M10079",	"M1008",	"M1009",	"M1010",	"M10111",	"M10112",	"M10119",	"M10121",	"M10122",	"M10129",	"M10131",	"M10132",	"M10139",	"M10141",	"M10142",	"M10149",	"M10151",	"M10152",	"M10159",	"M10161",	"M10162",	"M10169",	"M10171",	"M10172",	"M10179",	"M1018",	"M1019",	"M1020",	"M10211",	"M10212",	"M10219",	"M10221",	"M10222",	"M10229",	"M10231",	"M10232",	"M10239",	"M10241",	"M10242",	"M10249",	"M10251",	"M10252",	"M10259",	"M10261",	"M10262",	"M10269",	"M10271",	"M10272",	"M10279",	"M1028",	"M1029",	"M1030",	"M10311",	"M10312",	"M10319",	"M10321",	"M10322",	"M10329",	"M10331",	"M10332",	"M10339",	"M10341",	"M10342",	"M10349",	"M10351",	"M10352",	"M10359",	"M10361",	"M10362",	"M10369",	"M10371",	"M10372",	"M10379",	"M1038",	"M1039",	"M1040",	"M10411",	"M10412",	"M10419",	"M10421",	"M10422",	"M10429",	"M10431",	"M10432",	"M10439",	"M10441",	"M10442",	"M10449",	"M10451",	"M10452",	"M10459",	"M10461",	"M10462",	"M10469",	"M10471",	"M10472",	"M10479",	"M1048",	"M1049",	"M109",	"M119",
"M1A00X0","M1A00X1","M1A0110","M1A0111","M1A0120","M1A0121","M1A0190","M1A0191","M1A0210","M1A0211","M1A0220","M1A0221","M1A0290","M1A0291","M1A0310","M1A0311","M1A0320","M1A0321","M1A0390","M1A0391","M1A0410","M1A0411","M1A0420","M1A0421","M1A0490","M1A0491","M1A0510","M1A0511","M1A0520","M1A0521","M1A0590","M1A0591","M1A0610","M1A0611","M1A0620","M1A0621","M1A0690","M1A0691","M1A0710","M1A0711","M1A0720","M1A0721","M1A0790","M1A0791","M1A08X0","M1A08X1","M1A09X0","M1A09X1","M1A10X0","M1A10X1","M1A1110","M1A1111","M1A1120","M1A1121","M1A1190","M1A1191","M1A1210","M1A1211","M1A1220","M1A1221","M1A1290","M1A1291","M1A1310","M1A1311","M1A1320","M1A1321","M1A1390","M1A1391","M1A1410","M1A1411","M1A1420","M1A1421",
"M1A1490","M1A1491","M1A1510","M1A1511","M1A1520","M1A1521","M1A1590","M1A1591","M1A1610","M1A1611","M1A1620","M1A1621","M1A1690","M1A1691","M1A1710","M1A1711","M1A1720","M1A1721","M1A1790","M1A1791","M1A18X0","M1A18X1","M1A19X0","M1A19X1","M1A20X0","M1A20X1","M1A2110","M1A2111","M1A2120","M1A2121","M1A2190","M1A2191","M1A2210","M1A2211","M1A2220","M1A2221","M1A2290","M1A2291","M1A2310","M1A2311","M1A2320","M1A2321","M1A2390","M1A2391","M1A2410","M1A2411","M1A2420","M1A2421","M1A2490","M1A2491","M1A2510","M1A2511","M1A2520","M1A2521","M1A2590","M1A2591","M1A2610","M1A2611",
"M1A2620","M1A2621","M1A2690","M1A2691","M1A2710","M1A2711","M1A2720","M1A2721","M1A2790","M1A2791","M1A28X0","M1A28X1","M1A29X0","M1A29X1","M1A30X0","M1A30X1","M1A3110","M1A3111","M1A3120","M1A3121","M1A3190","M1A3191","M1A3210","M1A3211","M1A3220","M1A3221","M1A3290","M1A3291","M1A3310","M1A3311","M1A3320","M1A3321","M1A3390","M1A3391","M1A3410","M1A3411","M1A3420","M1A3421","M1A3490","M1A3491","M1A3510","M1A3511","M1A3520","M1A3521","M1A3590","M1A3591","M1A3610","M1A3611","M1A3620","M1A3621","M1A3690","M1A3691","M1A3710","M1A3711","M1A3720","M1A3721","M1A3790","M1A3791","M1A38X0","M1A38X1","M1A39X0","M1A39X1","M1A40X0","M1A40X1","M1A4110","M1A4111","M1A4120","M1A4121","M1A4190","M1A4191","M1A4210","M1A4211","M1A4220","M1A4221","M1A4290","M1A4291","M1A4310","M1A4311","M1A4320","M1A4321","M1A4390","M1A4391","M1A4410","M1A4411","M1A4420","M1A4421","M1A4490","M1A4491","M1A4510","M1A4511","M1A4520","M1A4521","M1A4590","M1A4591","M1A4610","M1A4611","M1A4620","M1A4621","M1A4690","M1A4691","M1A4710","M1A4711","M1A4720","M1A4721","M1A4790","M1A4791","M1A48X0","M1A48X1","M1A49X0","M1A49X1","M1A9XX0","M1A9XX1")

hypertension<-c("H35031",  "H35032",  "H35033",  "I10",  "I110",  "I119",  "I120",  "I129",  "I130",  "I1310",  "I1311",  "I132",  "I150",  "I151",  "I152",	 "I158",	"I159",	"I160",	"I161",	"I169",	"I674",	"I868",	"I87001",	"I87002",	"I87003",	"I87009",	"I87011",	"I87012",	"I87013",	"I87019",	"I87021",	"I87022",	"I87023",	"I87029",	"I87031",	"I87032",	"I87033",	"I87039",	"I87091",	"I87092",	"I87093",	"I87099",	"I871",	"I872",	"I87301",	"I87302",	"I87303",	"I87309",	"I87311",	"I87312",	"I87313",	"I87319",	"I87321",	"I87322",	"I87323",	"I87329",	"I87331",	"I87332",	"I87333",	"I87339",	"I87391",	"I87392",	"I87393",	"I87399",	"I973",	"O10011",	"O10011",	"O10012",	"O10012",	"O10013",	"O10013",	"O10019",	"O10019",	"O1002",	"O1002",	"O1003",	"O1003",	"O10111",	"O10111",	"O10112",	"O10112",	"O10113",	"O10113",	"O10119",	"O10119",	"O1012",	"O1012",	"O1013",	"O1013",	"O10211",	"O10211",	"O10212",	"O10212",	"O10213",	"O10213",	"O10219",	"O10219",	"O1022",	"O1022",	"O1023",	"O1023",	"O10311",	"O10311",	"O10312",	"O10312",	"O10313",	"O10313",	"O10319",	"O10319",	"O1032",	"O1032",	"O1033",	"O1033",	"O10411",	"O10411",	"O10412",	"O10412",	"O10413",	"O10413",	"O10419",	"O10419",	"O1042",	"O1042",	"O1043",	"O1043",	"O10911",	"O10911",	"O10912",	"O10912",	"O10913",	"O10913",	"O10919",	"O10919",	"O1092",	"O1092",	"O1093",	"O1093",	"O111",	"O111",	"O112",	"O112",	"O113",	"O113",	"O114",	"O114",	"O115",	"O115",	"O119",	"O119",	"O131",	"O131",	"O132",	"O132",	"O133",	"O133",	"O134",	"O134",	"O135",	"O135",	"O139",	"O139",	"O1400",	"O1402",	"O1403",	"O1404",	"O1405",	"O1410",	"O1412",	"O1413",	"O1414",	"O1415",	"O1420",	"O1422",	"O1423",	"O1424",	"O1425",	"O1490",	"O1492",	"O1493",	"O1494",	"O1495",	"O1500",	"O1502",	"O1503",	"O151",	"O152",	"O159",	"O161",	"O161",	"O162",	"O162",	"O163",	"O163",	"O164",	"O164",	"O165",	"O165",	"O169",	"O169")

pneumonia<-c("A0103",	"A0222",	"A202",	"A212",	"A221",	"A310",	"A3701",	"A3711",	"A3781",	"A3791",	"A430",	"A481",	"A5004",	"A5272",	"A5484",	"B012",	"B052",	"B0681",	"B250",	"B371",	"B380",	"B381",	"B382",	"B390",	"B391",	"B392",	"B583",	"B59",	"B7781",	"J091",	"J1000",	"J1001",	"J1008",	"J1100",	"J1108",	"J120",	"J121",	"J122",	"J123",	"J1281",	"J1289",	"J129",	"J13",	"J14",	"J150",	"J151",	"J1520",	"J15211",	"J15212",	"J1529",	"J153",	"J154",	"J155",	"J156",	"J157",	"J158",	"J159",	"J160",	"J168",	"J17",	"J180",	"J181",	"J188",	"J189",	"J690",	"J691",	"J698",	"J851",	"J954",	"J95851")
#need to add HLD to protocol
hyperlid<-c("E782", "E784", "E7849", "E785")
osa<-c("G4730", "G4731", "G4733", "G4737")


#nephropathy and neuropathy described using https://care.diabetesjournals.org/content/diacare/suppl/2018/03/20/dci18-0007.DC1/DCi180007SupplementaryData.pdf
#https://care.diabetesjournals.org/content/41/5/917.long
#create new for blindness, add into retinopathy/diabetes-related
#blindness<-ifelse(substring(ICD_10, 1, 3=="H54", 1,0))

#create new for INJURY OF CRANIAL, add into retinopathy/diabetes-related
#cran_nerve<-ifelse(substring(ICD_10, 1, 3=="S04", 1,0))
#dm-specific


dm_specific<-as.character(c(dm_shorterm_ICD10, dm_longterm_ICD10,diab_COMP_ICD10,dm_uncon))
dm_specific<-unlist(dm_specific)
rm(dm_shorterm_ICD10, dm_longterm_ICD10,diab_COMP_ICD10, dm_uncon)

dm_specific_cm<-function(x){
  spec1<-ifelse(x %in% dm_specific, 1, 0)
  return(spec1)
}
x$dmspec1<-as.numeric(Reduce('|', lapply(x[ICD], dm_specific_cm)))
dm_specific_prc<-function(x){
  spec2<-ifelse(x %in% leau, 1, 0)
  return(spec2)
}
x$dmspec2<-as.numeric(Reduce('|', lapply(x[ICD_prn], dm_specific_prc)))
x$dmspec3<-ifelse(x$dmspec1==1 | x$dmspec2==1, 1, 0)
x$spec<-ifelse(x$dmspec3==1 | x$hypo ==1, 1, 0)
x$spec1<-ifelse(x$I10_DX1 %in% dm_specific | x$I10_PR1 %in% leau, 1, 0)
drop<-colnames(x)[startsWith(colnames(x), "dmspec")]
x[drop]<-NULL

#dm-comorbid
diab_COMORBID_ICD10<-c(neuro, pvd, cvd, renal, metabol, opthal, other, acute_coronory, acute_myocardial, angina, arrythmia, CABG_carot_claudic_revasc, CABG_proccode, heart_fail, pad_pvd, stroke, retinopathy, depress, obesity, gout, hypertension, pneumonia, hyperlid,  osa)

dm_comorbid_cm<-function(x){
  spec1<-ifelse(x %in% diab_COMORBID_ICD10, 1, 0)
  spec2<- ifelse(substring(x, 1, 5) == "S9134" , 1,0)
  spec3<- ifelse(substring(x, 1, 3) == "L97" , 1,0)
  spec4<- ifelse(substring(x, 1, 5) == "S9134" , 1,0)
  spec5<-ifelse(substring(x, 1,3) %in% c("X71", "X72", "X73", "X74", "X75", "X76", "X77", "X78", "X79", "X80", "X81", "X82") , 1,0)
  spec<-ifelse(spec1==1 | spec2==1| spec3==1| spec4==1| spec5==1, 1, 0)
  return(spec)
}
x$com1<-as.numeric(Reduce('|', lapply(x[ICD], dm_comorbid_cm)))
dm_comorbid_prc<-function(x){
  CABG_intracran<-ifelse(substring(x, 1, 3) %in% "S04", 1,0)
  CABG_bypass<-ifelse(substring(x, 1, 3) %in% c("021", "031", "041", "051", "061"), 1,0)
  CABG_excision<-ifelse(substring(x, 1, 3) %in% c("04B", "04C", "04H", "04J", "04L", "04N", "04P", "04Q", "04R", "04S", "04U", "04V", "04W"), 1,0)
  CABG_excision1<-ifelse(substring(x, 1, 4) %in% c("045K", "045L", "045M", "045N", "045P", "045Q", "045R", "045S", "045T", "045U", "045V", "045W", "045Y"), 1,0)
  CABG1<-ifelse(x %in% CABG_proccode, 1, 0)
  spec2<-ifelse(CABG_intracran==1 | CABG_bypass==1| CABG_excision==1 | CABG_excision1==1, 1,0 )
  return(spec2)
}
x$com2<-as.numeric(Reduce('|', lapply(x[ICD_prn], dm_comorbid_prc)))
dm_comorbid_exc<-function(x){
  depress_excl_1<-ifelse(substring(x, 1,3) %in% c("F39", "F22", "F24", "F23", "F28", "F29"),1,0)
  depress_excl_2<-ifelse(substring(x, 1,4) %in% c("F301", "F302", "F323", "F333", "F311", "F312", "F313", "F314", "F315", "F316", "F319", "F348", "F208", "F201", "F202", "F200", "F208", "F205", "F259", "F209"),1,0)
  depress_excl_3<-ifelse(substring(x, 1,4) == "F4489", 1,0)
  spec3<-ifelse(depress_excl==1| depress_excl_2==1| depress_excl_3==1 , 1,0)
  return(spec3)
}
x$com3<-as.numeric(Reduce('|', lapply(x[ICD], dm_comorbid_exc)))
x$com4<-ifelse(x$com1==1 | x$com2==1, 1,0)
x$dm_com_all<-ifelse(x$com4==1 & x$com3==0,1,0)
x$dm_com<-ifelse(x$spec==0 & x$dm_com_all==1, 1, 0)
drop<-colnames(x)[startsWith(colnames(x), "com")]
x[drop]<-NULL


stroke_ind<-function(x){
  spec1<-ifelse(x %in% stroke, 1, 0)
  return(spec1)
}
x$stroke<-as.numeric(Reduce('|', lapply(x[ICD], stroke_ind)))
AMI_ind<-function(x){
  spec2<-ifelse(x %in% acute_myocardial, 1, 0)
  return(spec2)
}
x$ami<-as.numeric(Reduce('|', lapply(x[ICD], AMI_ind)))
ACS_ind<-function(x){
  spec2<-ifelse(x %in% acute_coronory, 1, 0)
  return(spec2)
}
x$acs<-as.numeric(Reduce('|', lapply(x[ICD], ACS_ind)))
heart_fail_ind<-function(x){
  spec2<-ifelse(x %in% heart_fail, 1, 0)
  return(spec2)
}
x$heart_fail<-as.numeric(Reduce('|', lapply(x[ICD], heart_fail_ind)))
arrythmia_ind<-function(x){
  spec2<-ifelse(x %in% arrythmia, 1, 0)
  return(spec2)
}
x$arrythmia<-as.numeric(Reduce('|', lapply(x[ICD], arrythmia_ind)))
x$comgroup<-ifelse(x$stroke==1|x$ami==1|x$acs==1|x$heart_fail==1|x$arrythmia==1,1,0)
comgroup<-c("stroke", "ami", "acs", "heart_fail", "arrythmia")
x[comgroup]<-NULL

rm(neuro, pvd, cvd, renal, metabol, opthal, other, acute_coronory, acute_myocardial, angina, arrythmia, CABG_carot_claudic_revasc, CABG_proccode, heart_fail, pad_pvd, stroke, retinopathy, depress, obesity, gout, hypertension, pneumonia, hyperlid,  osa)

#injury from https://www.hcup-us.ahrq.gov/db/vars/i10_injury/nedsnote.jsp
inj_3char<-c(paste0("S0", 0:9), 
        paste0("S", 10:99), 
        paste0("T0", 7:9), 
        paste0("T", 10:34), 
        paste0("T", 36:76),
        #Excluded from this range are adverse effects and underdosing of drugs, medicaments and biological substances (codes with the 6th character of 5 or 6) with the following exceptions: T36.9, T37.9, T39.9, T41.4, T42.7, T43.9, T45.9, T47.9, and T49.9 with a 5th character of 1, 2, 3, or 4
        "T79", "M97" )
inj_4char<-c("T8404", "O9A2", "09A3", "09A4", "09A5")
  
inj_ind<-function(x){
inj_1<- ifelse(substring(x, 1,3) %in% inj_3char, 1, 0)
inj_2<-ifelse(substring(x, 1,4) %in% inj_4char, 1, 0)
inj_3<- ifelse(inj_1==1 & substring(x,7) %in% c("A", "B", "C", ""), 1,0)
inj_4<- ifelse(inj_2==1 & substring(x,7) %in% c("A", "B", "C", ""), 1,0)
inj<-ifelse(inj_3==1 | inj_4==1, 1, 0)
inj_exc1<- ifelse(inj==1 & substring(x,1,4) %in% c("T369", "T379", "T399", "T414", "T427", "T439", "T459", "T479", "T499"), 1,0)
inj_exc<- ifelse(inj_exc1==1 & substring(x, 5) %in% c(1,2,3,4), 1,0)
non_dm<-ifelse(inj ==1 & inj_exc ==0, 1,0)
return(non_dm)
}
ICD<-startsWith(colnames(x), "I10_DX")
x$inj_any<-as.numeric(Reduce('|', lapply(x[ICD], inj_ind)))
x$inj<-ifelse(x$comgroup==0 & x$spec==0 & x$inj_any==1, 1,0)
  
x$dxreason2<-ifelse(x$spec==1, "DM-specific", (ifelse(x$dm_com==1, "DM-Comorbidity-Only", ifelse(x$inj==1, "Injury-Only", "missing"))))
x$dxreason3<-ifelse(x$inj==1, "Injury", ifelse(x$spec==1, "DM-specific", ifelse(x$dm_com==1, "DM-Comorbidity-Only", ifelse(x$inj_any==1, "Injury",  "missing"))))
x$dxreason<- ifelse(x$spec==1, "DM-specific", ifelse(x$dm_com==1, "DM-Comorbidity-Only", ifelse(x$inj==1, "Injury", ifelse(x$inj_any==1, "Injury",  "missing"))))
gc()
return(x)
}
```

```{r}
```


```{r}
chck10
sum(chck10$freq)
```

