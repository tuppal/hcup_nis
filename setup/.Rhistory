knitr::opts_chunk$set(echo = TRUE)
if(!require(knitr)){
install.packages("knitr")
library(knitr)
}
if(!require(comorbidity)){
install.packages("comorbidity")
library(comorbidity)
}
if(!require(readxl)){
install.packages("readxl")
library(readxl)
}
if(!require(digest)){
install.packages("digest")
library(digest)
}
if(!require(ggplot2)){
install.packages("ggplot2")
library(ggplot2)
}
if(!require(pheatmap)){
install.packages("pheatmap")
library(pheatmap)
}
if(!require(tidyverse)){
install.packages("tidyverse")
library(tidyverse)
}
if(!require(prodlim)){
install.packages("prodlim")
library(prodlim)
}
if(!require(recipes)){
install.packages("recipes")
library(recipes)
}
if(!require(data.table)){
install.packages("data.table")
library(data.table)
}
if(!require(RColorBrewer)){
install.packages("RColorBrewer")
library(RColorBrewer)
}
if(!require(foreign)){
install.packages("foreign")
library(foreign)
}
if(!require(tidyverse)){
install.packages("tidyverse")
library(tidyverse)
}
if(!require(plyr)){
install.packages("plyr")
library(plyr)
}
if(!require(summarytools)){
install.packages("summarytools")
library(summarytools)
}
if(!require(survey)){
install.packages("survey")
library(survey)
}
if(!require(dsr)){
install.packages("dsr")
library(dsr)
}
if(!require(kableExtra)){
install.packages("kableExtra")
library(kableExtra)
}
if(!require(magrittr)){
install.packages("magrittr")
library(magrittr)
}
if(!require(scales)){
install.packages("scales")
library(scales)
}
if(!require(openxlsx)){
install.packages("openxlsx")
library(openxlsx )
}
if(!require(surveydata)){
install.packages("surveydata")
library(surveydata )
}
if(!require(margins)){
install.packages("margins")
library(margins )
}
if(!require(car)){
install.packages("car")
library(car )
}
if(!require(agricolae)){
install.packages("agricolae")
library(agricolae )
}
if(!require(etm)){
install.packages("etm")
library(etm )
}
if(!require(popEpi)){
install.packages("popEpi")
library(popEpi )
}
if(!require(Epi)){
install.packages("Epi")
library(Epi )
}
if(!require(survival)){
install.packages("survival")
library(survival )
}
if(!require(data.table)){
install.packages("data.table")
library(data.table )
}
#function to generate proportions
prop<-function(x){paste("(",round((x/(sum(x))*100), digits=1),"%",")",sep="")}
#function to place number in parenthesis
prnth<-function(x){paste0("(", x,")")}
#define function to coerce numbers into thousands (simplify reading millions in tables)
thou_round<-function(x){
x<-round(x, digits=-3)
x<-x/1000
}
thou_noround<-function(x){
x<-x/1000
}
if(Sys.info()["user"]=="TUPPAL"){
repo<- "C:/Users/TUPPAL/merck/hcup_NIS/"
data_path <- "C:/Users/TUPPAL/merck/sid/"
nis_list <- dir(data_path)
az_sid<- paste0(data_path, "AZ_c")
fl_sid<- paste0(data_path, "FL_c")
ia_sid<- paste0(data_path, "IA_c")
ky_sid<- paste0(data_path, "KY_c")
md_sid<- paste0(data_path, "MD_c")
nc_sid<- paste0(data_path, "NC_c")
ne_sid<- paste0(data_path, "NE_c")
nj_sid<- paste0(data_path, "NJ_c")
ny_sid<- paste0(data_path, "NY_c")
ut_sid<- paste0(data_path, "UT_c")
vt_sid<- paste0(data_path, "VT_c")
}
getwd()
if(Sys.info()["user"]=="teg83"){
repo<- "C:/Users/teg83/Documents/GitHub/merck/hcup_NIS/"
data_path <- paste0(repo, "Data")
nis_list <- dir(data_path)
az_sid<- paste0(data_path, "AZ_c")
fl_sid<- paste0(data_path, "FL_c")
ia_sid<- paste0(data_path, "IA_c")
ky_sid<- paste0(data_path, "KY_c")
md_sid<- paste0(data_path, "MD_c")
nc_sid<- paste0(data_path, "NC_c")
ne_sid<- paste0(data_path, "NE_c")
nj_sid<- paste0(data_path, "NJ_c")
ny_sid<- paste0(data_path, "NY_c")
ut_sid<- paste0(data_path, "UT_c")
vt_sid<- paste0(data_path, "VT_c")
}
if(Sys.info()["user"]=="starsdliu"){
repo<- "/Users/starsdliu/Desktop/Rollins School of Public Health Research/Diabetes Program - Dr. Ali and Teg/MEPS Data/MEPS/ACSC_ED"
data_path <- paste0(repo, "Data")
nis_list <- dir(fc_path)
}
#If not one of the above users, enter user name and location of REPO and remove # to run code
#if(Sys.info()["user"]=="*ENTER USER NAME HERE"){
#  repo<- *ENTER REPO LOCATION HERE*
#data_path <- paste0(repo, "Data")
#nis_list <- dir(fc_path)
#}
nis_list <- dir(data_path)
az_list<- dir(az_sid)
fl_list<- dir(fl_sid)
ia_list<- dir(ia_sid)
ky_list<- dir(ky_sid)
md_list<- dir(md_sid)
nc_list<- dir(nc_sid)
ne_list<- dir(ne_sid)
nj_list<- dir(nj_sid)
ny_list<- dir(ny_sid)
ut_list<- dir(ut_sid)
vt_list<- dir(vt_sid)
sid_list<-as.list(c(az_sid, fl_sid, ia_sid, ky_sid, md_sid, nc_sid, ne_sid, nj_sid, ny_sid, ut_sid, vt_sid))
sid_list
```{r}
nis_list <- dir(data_path)
az_list<- dir(az_sid)
fl_list<- dir(fl_sid)
ia_list<- dir(ia_sid)
ky_list<- dir(ky_sid)
md_list<- dir(md_sid)
nc_list<- dir(nc_sid)
ne_list<- dir(ne_sid)
nj_list<- dir(nj_sid)
ny_list<- dir(ny_sid)
ut_list<- dir(ut_sid)
vt_list<- dir(vt_sid)
az_list
s<-open_sid(az_sid)
#Import Arizona - year 2017
open_sid<-function(x){
x_08<-dir(paste0(x, "/2008"))
x_11<-dir(paste0(x, "/2011"))
x_14<-dir(paste0(x, "/2014"))
x_17<-dir(paste0(x, "/2017"))
y<-as.list(c(x_08,x_11,x_14,x_17))
core<-grep("core", y)
c_08<-core[1]
x_08_c<-y[c_08]
c_11<-core[2]
x_11_c<-y[c_11]
c_14<-core[3]
x_14_c<-y[c_14]
c_17<-core[4]
x_17_c<-y[c_17]
y<-as.list(c(x_08_c, x_11_c, x_14_c, x_17_c))
return(y)
}
s<-open_sid(az_sid)
s[1]
substring(sid_list[1], 27, 28)
s
chck<-sid_list[1]
chck1<-s[1]
chck1
paste0(sid_list[1],"/", s[1])
(paste0(sid_list[1],"/", substring(s[1], 9, 12), "/", s[1])
)
(paste0(sid_list[1],"/", substring(s[1], 9, 12), "/", s[1]))
nis_list <- dir(data_path)
az_list<- dir(az_sid)
fl_list<- dir(fl_sid)
ia_list<- dir(ia_sid)
ky_list<- dir(ky_sid)
md_list<- dir(md_sid)
nc_list<- dir(nc_sid)
ne_list<- dir(ne_sid)
nj_list<- dir(nj_sid)
ny_list<- dir(ny_sid)
ut_list<- dir(ut_sid)
vt_list<- dir(vt_sid)
az_list
sid_list<-as.list(c(az_sid, fl_sid, ia_sid, ky_sid, md_sid, nc_sid, ne_sid, nj_sid, ny_sid, ut_sid, vt_sid))
sid_list
az_08<-read_sas(paste0(sid_list[1],"/", substring(s[1], 9, 12), "/", s[1]))
(paste0(sid_list[1],"/", substring(s[1], 9, 12), "/", s[1]))
install.packages("haven")
require(haven)
library("haven")
install.packages("haven")
s<-open_sid(nc_sid)
s[1]
substring(sid_list[1], 27, 28)
s<-open_sid(nc_sid)
s[1]
substring(sid_list[1], 27, 28)
s<-open_sid(nc_sid)
s[1]
substring(sid_list[1], 27, 28)
s
chck<-sid_list[1]
chck1<-s[1]
chck1
paste0(sid_list[1],"/", s[1])
paste0(sid_list[1],"/", s[1])
(paste0(sid_list[1],"/", substring(s[1], 9, 12), "/", s[1]))
nc_08<-read_sas(paste0(sid_list[1],"/", substring(s[1], 9, 12), "/", s[1]))
nc_08<-read_sas(paste0(sid_list[6],"/", substring(s[1], 9, 12), "/", s[1]))
)
mean(nc_08$AGE)
mean(nc_08$AGE, na.rm=T)
sid_list<-as.list(c(nc_sid, ne_sid, nj_sid, ny_sid, ut_sid, vt_sid))
sid_list
for (i in seq_along(sid_list[c(1:6)])){
y<-open_sid(sid_list[i])
rds_08<-assign(substring(sid_list[i], 27, 28), read_sas(paste0(sid_list[i],"/", substring(y[1], 9, 12), "/", y[1])))
saveRDS(rds_08, file=paste0("H:/Job/Merck/HCUP_data/SID_obj", "/", substring(y[1], 1,12), ".RDS"))
rm(rds_08)
gc()
rds_11<-assign(substring(sid_list[i], 27, 28), read_sas(paste0(sid_list[i],"/", substring(y[2], 9, 12), "/", y[2])))
saveRDS(rds_11, file=paste0("H:/Job/Merck/HCUP_data/SID_obj", "/", substring(y[2], 1,12), ".RDS"))
rm(rds_11)
gc()
rds_14<-assign(substring(sid_list[i], 27, 28), read_sas(paste0(sid_list[i],"/", substring(y[3], 9, 12), "/", y[3])))
saveRDS(rds_14, file=paste0("H:/Job/Merck/HCUP_data/SID_obj", "/", substring(y[3], 1,12), ".RDS"))
rm(rds_14)
gc()
rds_17<-assign(substring(sid_list[i], 27, 28), read_sas(paste0(sid_list[i],"/", substring(y[4], 9, 12), "/", y[4])))
saveRDS(rds_17, file=paste0("H:/Job/Merck/HCUP_data/SID_obj", "/", substring(y[4], 1,12), ".RDS"))
rm(rds_17)
gc()
}
